!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("ethers")):"function"==typeof define&&define.amd?define("SynapseSDK",["ethers"],t):"object"==typeof exports?exports.SynapseSDK=t(require("ethers")):e.SynapseSDK=t(e.ethers)}(this,e=>(()=>{"use strict";var t={320:t=>{t.exports=e}},n={};function r(e){var i=n[e];if(void 0!==i)return i.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};r.d(i,{default:()=>cr});var a={};r.r(a),r.d(a,{code:()=>pe,digest:()=>oe,name:()=>re,size:()=>ie});var s={};r.r(s),r.d(s,{asLegacyPieceCID:()=>Un,asPieceCID:()=>Nn,calculate:()=>On,createPieceCIDStream:()=>Fn,downloadAndValidate:()=>R,downloadAndValidateFromUrl:()=>M});var o={};r.r(o),r.d(o,{PDPAuthHelper:()=>Ln,PDPServer:()=>qn,PDPVerifier:()=>Zn,asDataSetData:()=>Kn,asDataSetPieceData:()=>Gn,isDataSetCreationStatusResponse:()=>Bn,isFindPieceResponse:()=>Vn,isPieceAdditionStatusResponse:()=>zn,validateDataSetCreationStatusResponse:()=>Wn,validateFindPieceResponse:()=>Hn,validatePieceAdditionStatusResponse:()=>jn});var p={};r.r(p),r.d(p,{SPRegistryService:()=>Qn});var d={};r.r(d),r.d(d,{CHAIN_IDS:()=>y,CONTRACT_ABIS:()=>c,CONTRACT_ADDRESSES:()=>w,GENESIS_TIMESTAMPS:()=>h,PDPAuthHelper:()=>Ln,PDPServer:()=>qn,PDPVerifier:()=>Zn,PaymentsService:()=>x,RPC_URLS:()=>v,SIZE_CONSTANTS:()=>f,StorageContext:()=>Xn,StorageManager:()=>Jn,StorageService:()=>Xn,SubgraphService:()=>sr,Synapse:()=>yr,TIME_CONSTANTS:()=>m,TIMING_CONSTANTS:()=>g,TOKENS:()=>l,WarmStorageService:()=>lr,asDataSetData:()=>Kn,asDataSetPieceData:()=>Gn,calculateLastProofDate:()=>C,constructFindPieceUrl:()=>E,constructPieceUrl:()=>_,createError:()=>T,dateToEpoch:()=>P,epochToDate:()=>S,getCurrentEpoch:()=>A,getFilecoinNetworkType:()=>D,getGenesisTimestamp:()=>b,isDataSetCreationStatusResponse:()=>Bn,isFindPieceResponse:()=>Vn,isPieceAdditionStatusResponse:()=>zn,timeUntilEpoch:()=>I,validateDataSetCreationStatusResponse:()=>Wn,validateFindPieceResponse:()=>Hn,validatePieceAdditionStatusResponse:()=>jn});var u=r(320);const l={USDFC:"USDFC",FIL:"FIL"},y={mainnet:314,calibration:314159},c={ERC20:[{type:"event",name:"Approval",inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"event",name:"Transfer",inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}]},{type:"function",name:"allowance",stateMutability:"view",inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{name:"account",type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"name",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:"string"}]},{type:"function",name:"totalSupply",stateMutability:"view",inputs:[],outputs:[{type:"uint256"}]},{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],PAYMENTS:[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"COMMISSION_MAX_BPS",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NETWORK_FEE",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"}],name:"accounts",outputs:[{name:"funds",internalType:"uint256",type:"uint256"},{name:"lockupCurrent",internalType:"uint256",type:"uint256"},{name:"lockupRate",internalType:"uint256",type:"uint256"},{name:"lockupLastSettledAt",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"validator",internalType:"address",type:"address"},{name:"commissionRateBps",internalType:"uint256",type:"uint256"},{name:"serviceFeeRecipient",internalType:"address",type:"address"}],name:"createRail",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"deposit",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"}],name:"depositWithPermit",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"depositWithPermitAndApproveOperator",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"v",internalType:"uint8",type:"uint8"},{name:"r",internalType:"bytes32",type:"bytes32"},{name:"s",internalType:"bytes32",type:"bytes32"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"depositWithPermitAndIncreaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"owner",internalType:"address",type:"address"}],name:"getAccountInfoIfSettled",outputs:[{name:"fundedUntilEpoch",internalType:"uint256",type:"uint256"},{name:"currentFunds",internalType:"uint256",type:"uint256"},{name:"availableFunds",internalType:"uint256",type:"uint256"},{name:"currentLockupRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"getRail",outputs:[{name:"",internalType:"struct Payments.RailView",type:"tuple",components:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"validator",internalType:"address",type:"address"},{name:"paymentRate",internalType:"uint256",type:"uint256"},{name:"lockupPeriod",internalType:"uint256",type:"uint256"},{name:"lockupFixed",internalType:"uint256",type:"uint256"},{name:"settledUpTo",internalType:"uint256",type:"uint256"},{name:"endEpoch",internalType:"uint256",type:"uint256"},{name:"commissionRateBps",internalType:"uint256",type:"uint256"},{name:"serviceFeeRecipient",internalType:"address",type:"address"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"payee",internalType:"address",type:"address"},{name:"token",internalType:"address",type:"address"}],name:"getRailsForPayeeAndToken",outputs:[{name:"",internalType:"struct Payments.RailInfo[]",type:"tuple[]",components:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"isTerminated",internalType:"bool",type:"bool"},{name:"endEpoch",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"},{name:"token",internalType:"address",type:"address"}],name:"getRailsForPayerAndToken",outputs:[{name:"",internalType:"struct Payments.RailInfo[]",type:"tuple[]",components:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"isTerminated",internalType:"bool",type:"bool"},{name:"endEpoch",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"getRateChangeQueueSize",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"",internalType:"address",type:"address"}],name:"hasCollectedFees",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"rateAllowanceIncrease",internalType:"uint256",type:"uint256"},{name:"lockupAllowanceIncrease",internalType:"uint256",type:"uint256"}],name:"increaseOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"period",internalType:"uint256",type:"uint256"},{name:"lockupFixed",internalType:"uint256",type:"uint256"}],name:"modifyRailLockup",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"newRate",internalType:"uint256",type:"uint256"},{name:"oneTimePayment",internalType:"uint256",type:"uint256"}],name:"modifyRailPayment",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"}],name:"operatorApprovals",outputs:[{name:"isApproved",internalType:"bool",type:"bool"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"rateUsage",internalType:"uint256",type:"uint256"},{name:"lockupUsage",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"approved",internalType:"bool",type:"bool"},{name:"rateAllowance",internalType:"uint256",type:"uint256"},{name:"lockupAllowance",internalType:"uint256",type:"uint256"},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256"}],name:"setOperatorApproval",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"untilEpoch",internalType:"uint256",type:"uint256"}],name:"settleRail",outputs:[{name:"totalSettledAmount",internalType:"uint256",type:"uint256"},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256"},{name:"totalOperatorCommission",internalType:"uint256",type:"uint256"},{name:"finalSettledEpoch",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}],stateMutability:"payable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"settleTerminatedRailWithoutValidation",outputs:[{name:"totalSettledAmount",internalType:"uint256",type:"uint256"},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256"},{name:"totalOperatorCommission",internalType:"uint256",type:"uint256"},{name:"finalSettledEpoch",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"terminateRail",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"withdraw",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"token",internalType:"address",type:"address"},{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"withdrawTo",outputs:[],stateMutability:"nonpayable"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"address",type:"address",indexed:!0},{name:"owner",internalType:"address",type:"address",indexed:!0},{name:"lockupCurrent",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupRate",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupLastSettledAt",internalType:"uint256",type:"uint256",indexed:!1}],name:"AccountLockupSettled"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"address",type:"address",indexed:!0},{name:"from",internalType:"address",type:"address",indexed:!0},{name:"to",internalType:"address",type:"address",indexed:!0},{name:"amount",internalType:"uint256",type:"uint256",indexed:!1},{name:"usedPermit",internalType:"bool",type:"bool",indexed:!1}],name:"DepositRecorded"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"address",type:"address",indexed:!0},{name:"client",internalType:"address",type:"address",indexed:!0},{name:"operator",internalType:"address",type:"address",indexed:!0},{name:"approved",internalType:"bool",type:"bool",indexed:!1},{name:"rateAllowance",internalType:"uint256",type:"uint256",indexed:!1},{name:"lockupAllowance",internalType:"uint256",type:"uint256",indexed:!1},{name:"maxLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1}],name:"OperatorApprovalUpdated"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"payer",internalType:"address",type:"address",indexed:!0},{name:"payee",internalType:"address",type:"address",indexed:!0},{name:"token",internalType:"address",type:"address",indexed:!1},{name:"operator",internalType:"address",type:"address",indexed:!1},{name:"validator",internalType:"address",type:"address",indexed:!1},{name:"serviceFeeRecipient",internalType:"address",type:"address",indexed:!1},{name:"commissionRateBps",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailCreated"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0}],name:"RailFinalized"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1},{name:"newLockupPeriod",internalType:"uint256",type:"uint256",indexed:!1},{name:"oldLockupFixed",internalType:"uint256",type:"uint256",indexed:!1},{name:"newLockupFixed",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailLockupModified"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"netPayeeAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"operatorCommission",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailOneTimePaymentProcessed"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldRate",internalType:"uint256",type:"uint256",indexed:!1},{name:"newRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailRateModified"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"totalSettledAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"totalNetPayeeAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"operatorCommission",internalType:"uint256",type:"uint256",indexed:!1},{name:"settledUpTo",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailSettled"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!0},{name:"by",internalType:"address",type:"address",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailTerminated"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"event",anonymous:!1,inputs:[{name:"token",internalType:"address",type:"address",indexed:!0},{name:"from",internalType:"address",type:"address",indexed:!0},{name:"to",internalType:"address",type:"address",indexed:!0},{name:"amount",internalType:"uint256",type:"uint256",indexed:!1}],name:"WithdrawRecorded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxSettlementEpoch",internalType:"uint256",type:"uint256"},{name:"blockNumber",internalType:"uint256",type:"uint256"}],name:"CannotModifyTerminatedRailBeyondEndEpoch"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxAllowedEpoch",internalType:"uint256",type:"uint256"},{name:"attemptedEpoch",internalType:"uint256",type:"uint256"}],name:"CannotSettleFutureEpochs"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"requiredBlock",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"CannotSettleTerminatedRailBeforeMaxEpoch"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionRateTooHigh"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"oldLockup",internalType:"uint256",type:"uint256"},{name:"currentLockup",internalType:"uint256",type:"uint256"}],name:"CurrentLockupLessThanOldLockup"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"from",internalType:"address",type:"address"},{name:"token",internalType:"address",type:"address"},{name:"currentLockup",internalType:"uint256",type:"uint256"},{name:"lockupReduction",internalType:"uint256",type:"uint256"}],name:"InsufficientCurrentLockup"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"required",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForOneTimePayment"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"InsufficientFundsForSettlement"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"InsufficientLockupForSettlement"},{type:"error",inputs:[{name:"required",internalType:"uint256",type:"uint256"},{name:"sent",internalType:"uint256",type:"uint256"}],name:"InsufficientNativeTokenForBurn"},{type:"error",inputs:[{name:"available",internalType:"uint256",type:"uint256"},{name:"requested",internalType:"uint256",type:"uint256"}],name:"InsufficientUnlockedFunds"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[{name:"nextRateChangeUntilEpoch",internalType:"uint256",type:"uint256"},{name:"processedEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidRateChangeQueueState"},{type:"error",inputs:[{name:"actualPeriod",internalType:"uint256",type:"uint256"},{name:"actualLockupFixed",internalType:"uint256",type:"uint256"},{name:"attemptedPeriod",internalType:"uint256",type:"uint256"},{name:"attemptedLockupFixed",internalType:"uint256",type:"uint256"}],name:"InvalidTerminatedRailModification"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"account",internalType:"address",type:"address"},{name:"lockupCurrent",internalType:"uint256",type:"uint256"},{name:"fundsCurrent",internalType:"uint256",type:"uint256"}],name:"LockupExceedsFundsInvariant"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"actualLockupFixed",internalType:"uint256",type:"uint256"},{name:"attemptedLockupFixed",internalType:"uint256",type:"uint256"}],name:"LockupFixedIncreaseNotAllowedDueToInsufficientFunds"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"expectedLockup",internalType:"uint256",type:"uint256"},{name:"actualLockup",internalType:"uint256",type:"uint256"}],name:"LockupInconsistencyDuringRailFinalization"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"isSettled",internalType:"bool",type:"bool"},{name:"currentRate",internalType:"uint256",type:"uint256"},{name:"attemptedRate",internalType:"uint256",type:"uint256"}],name:"LockupNotSettledRateChangeNotAllowed"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"from",internalType:"address",type:"address"},{name:"actualLockupPeriod",internalType:"uint256",type:"uint256"},{name:"attemptedLockupPeriod",internalType:"uint256",type:"uint256"}],name:"LockupPeriodChangeNotAllowedDueToInsufficientFunds"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"},{name:"maxAllowedPeriod",internalType:"uint256",type:"uint256"},{name:"requestedPeriod",internalType:"uint256",type:"uint256"}],name:"LockupPeriodExceedsOperatorMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"paymentRate",internalType:"uint256",type:"uint256"},{name:"lockupRate",internalType:"uint256",type:"uint256"}],name:"LockupRateInconsistent"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"from",internalType:"address",type:"address"},{name:"lockupRate",internalType:"uint256",type:"uint256"},{name:"oldRate",internalType:"uint256",type:"uint256"}],name:"LockupRateLessThanOldRate"},{type:"error",inputs:[],name:"MissingServiceFeeRecipient"},{type:"error",inputs:[{name:"required",internalType:"uint256",type:"uint256"},{name:"sent",internalType:"uint256",type:"uint256"}],name:"MustSendExactNativeAmount"},{type:"error",inputs:[{name:"sent",internalType:"uint256",type:"uint256"}],name:"NativeTokenNotAccepted"},{type:"error",inputs:[],name:"NativeTokenNotSupported"},{type:"error",inputs:[{name:"to",internalType:"address",type:"address"},{name:"amount",internalType:"uint256",type:"uint256"}],name:"NativeTransferFailed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"expectedSettledUpTo",internalType:"uint256",type:"uint256"},{name:"actualSettledUpTo",internalType:"uint256",type:"uint256"}],name:"NoProgressInSettlement"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedClient",internalType:"address",type:"address"},{name:"allowedOperator",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"NotAuthorizedToTerminateRail"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"available",internalType:"uint256",type:"uint256"},{name:"required",internalType:"uint256",type:"uint256"}],name:"OneTimePaymentExceedsLockup"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailClientAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailOperatorAllowed"},{type:"error",inputs:[{name:"expectedFrom",internalType:"address",type:"address"},{name:"expectedOperator",internalType:"address",type:"address"},{name:"expectedTo",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"OnlyRailParticipantAllowed"},{type:"error",inputs:[{name:"allowed",internalType:"uint256",type:"uint256"},{name:"attemptedUsage",internalType:"uint256",type:"uint256"}],name:"OperatorLockupAllowanceExceeded"},{type:"error",inputs:[{name:"from",internalType:"address",type:"address"},{name:"operator",internalType:"address",type:"address"}],name:"OperatorNotApproved"},{type:"error",inputs:[{name:"allowed",internalType:"uint256",type:"uint256"},{name:"attemptedUsage",internalType:"uint256",type:"uint256"}],name:"OperatorRateAllowanceExceeded"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"PermitRecipientMustBeMsgSender"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailAlreadyTerminated"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailInactiveOrSettled"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotTerminated"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RateChangeNotAllowedOnTerminatedRail"},{type:"error",inputs:[{name:"nextUntilEpoch",internalType:"uint256",type:"uint256"}],name:"RateChangeQueueNotEmpty"},{type:"error",inputs:[],name:"ReentrancyGuardReentrantCall"},{type:"error",inputs:[{name:"token",internalType:"address",type:"address"}],name:"SafeERC20FailedOperation"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"attempted",internalType:"uint256",type:"uint256"}],name:"ValidatorModifiedAmountExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedStart",internalType:"uint256",type:"uint256"},{name:"attemptedStart",internalType:"uint256",type:"uint256"}],name:"ValidatorSettledBeforeSegmentStart"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"allowedEnd",internalType:"uint256",type:"uint256"},{name:"attemptedEnd",internalType:"uint256",type:"uint256"}],name:"ValidatorSettledBeyondSegmentEnd"},{type:"error",inputs:[{name:"varName",internalType:"string",type:"string"}],name:"ZeroAddressNotAllowed"}],PDP_VERIFIER:[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"BURN_ACTOR",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"EXTRA_DATA_MAX_SIZE",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"FIL_USD_PRICE_FEED_ID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[],name:"LEAF_SIZE",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_ENQUEUED_REMOVALS",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_PIECE_SIZE_LOG2",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NO_CHALLENGE_SCHEDULED",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"NO_PROVEN_EPOCH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"PYTH",outputs:[{name:"",internalType:"contract IPyth",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"RANDOMNESS_PRECOMPILE",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"SECONDS_IN_DAY",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceData",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"addPieces",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"estimatedGasFee",internalType:"uint256",type:"uint256"}],name:"calculateProofFee",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"claimDataSetStorageProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"listenerAddr",internalType:"address",type:"address"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"createDataSet",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"dataSetLive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"deleteDataSet",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"leafIndexs",internalType:"uint256[]",type:"uint256[]"}],name:"findPieceIds",outputs:[{name:"",internalType:"struct IPDPTypes.PieceIdAndOffset[]",type:"tuple[]",components:[{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getActivePieceCount",outputs:[{name:"activeCount",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getActivePieces",outputs:[{name:"pieces",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"rawSizes",internalType:"uint256[]",type:"uint256[]"},{name:"hasMore",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"getChallengeFinality",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getChallengeRange",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetLastProvenEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetLeafCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetListener",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getDataSetStorageProvider",outputs:[{name:"",internalType:"address",type:"address"},{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"getFILUSDPrice",outputs:[{name:"",internalType:"uint64",type:"uint64"},{name:"",internalType:"int32",type:"int32"}],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getNextChallengeEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getNextDataSetId",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getNextPieceId",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getPieceCid",outputs:[{name:"",internalType:"struct Cids.Cid",type:"tuple",components:[{name:"data",internalType:"bytes",type:"bytes"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getPieceLeafCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"epoch",internalType:"uint256",type:"uint256"}],name:"getRandomness",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"getScheduledRemovals",outputs:[{name:"",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"_challengeFinality",internalType:"uint256",type:"uint256"}],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"challengeEpoch",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"nextProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"pieceChallengable",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"pieceLive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"newStorageProvider",internalType:"address",type:"address"}],name:"proposeDataSetStorageProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"proofs",internalType:"struct IPDPTypes.Proof[]",type:"tuple[]",components:[{name:"leaf",internalType:"bytes32",type:"bytes32"},{name:"proof",internalType:"bytes32[]",type:"bytes32[]"}]}],name:"provePossession",outputs:[],stateMutability:"payable"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"schedulePieceDeletions",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"storageProvider",internalType:"address",type:"address",indexed:!0}],name:"DataSetCreated"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"deletedLeafCount",internalType:"uint256",type:"uint256",indexed:!1}],name:"DataSetDeleted"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0}],name:"DataSetEmpty"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"challengeEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"leafCount",internalType:"uint256",type:"uint256",indexed:!1}],name:"NextProvingPeriod"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]",indexed:!1},{name:"pieceCids",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}],indexed:!1}],name:"PiecesAdded"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]",indexed:!1}],name:"PiecesRemoved"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"challenges",internalType:"struct IPDPTypes.PieceIdAndOffset[]",type:"tuple[]",components:[{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"offset",internalType:"uint256",type:"uint256"}],indexed:!1}],name:"PossessionProven"},{type:"event",anonymous:!1,inputs:[{name:"reason",internalType:"bytes",type:"bytes",indexed:!1}],name:"PriceOracleFailure"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"fee",internalType:"uint256",type:"uint256",indexed:!1},{name:"price",internalType:"uint64",type:"uint64",indexed:!1},{name:"expo",internalType:"int32",type:"int32",indexed:!1}],name:"ProofFeePaid"},{type:"event",anonymous:!1,inputs:[{name:"setId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldStorageProvider",internalType:"address",type:"address",indexed:!0},{name:"newStorageProvider",internalType:"address",type:"address",indexed:!0}],name:"StorageProviderChanged"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"idx",internalType:"uint256",type:"uint256"},{name:"msg",internalType:"string",type:"string"}],name:"IndexedError"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"}],WARM_STORAGE:[{type:"constructor",inputs:[{name:"_pdpVerifierAddress",internalType:"address",type:"address"},{name:"_paymentsContractAddress",internalType:"address",type:"address"},{name:"_usdfcTokenAddress",internalType:"address",type:"address"},{name:"_filCDNBeneficiaryAddress",internalType:"address",type:"address"},{name:"_serviceProviderRegistry",internalType:"contract ServiceProviderRegistry",type:"address"},{name:"_sessionKeyRegistry",internalType:"contract SessionKeyRegistry",type:"address"}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"addApprovedProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"totalBytes",internalType:"uint256",type:"uint256"}],name:"calculateRatesPerEpoch",outputs:[{name:"storageRate",internalType:"uint256",type:"uint256"},{name:"cacheMissRate",internalType:"uint256",type:"uint256"},{name:"cdnRate",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"_maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"_challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"configureProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"dataSetCreated",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"dataSetDeleted",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"eip712Domain",outputs:[{name:"fields",internalType:"bytes1",type:"bytes1"},{name:"name",internalType:"string",type:"string"},{name:"version",internalType:"string",type:"string"},{name:"chainId",internalType:"uint256",type:"uint256"},{name:"verifyingContract",internalType:"address",type:"address"},{name:"salt",internalType:"bytes32",type:"bytes32"},{name:"extensions",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"extsload",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"},{name:"size",internalType:"uint256",type:"uint256"}],name:"extsloadStruct",outputs:[{name:"",internalType:"bytes32[]",type:"bytes32[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"filCDNBeneficiaryAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"getEffectiveRates",outputs:[{name:"serviceFee",internalType:"uint256",type:"uint256"},{name:"spPayment",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"epoch",internalType:"uint256",type:"uint256"}],name:"getProvingPeriodForEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"getServicePrice",outputs:[{name:"pricing",internalType:"struct FilecoinWarmStorageService.ServicePricing",type:"tuple",components:[{name:"pricePerTiBPerMonthNoCDN",internalType:"uint256",type:"uint256"},{name:"pricePerTiBPerMonthWithCDN",internalType:"uint256",type:"uint256"},{name:"tokenAddress",internalType:"address",type:"address"},{name:"epochsPerMonth",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"_maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"_challengeWindowSize",internalType:"uint256",type:"uint256"},{name:"_filCDNControllerAddress",internalType:"address",type:"address"},{name:"_name",internalType:"string",type:"string"},{name:"_description",internalType:"string",type:"string"}],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"epoch",internalType:"uint256",type:"uint256"}],name:"isEpochProven",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"_viewContract",internalType:"address",type:"address"}],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"challengeEpoch",internalType:"uint256",type:"uint256"},{name:"leafCount",internalType:"uint256",type:"uint256"},{name:"",internalType:"bytes",type:"bytes"}],name:"nextProvingPeriod",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"paymentsContractAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"pdpVerifierAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"firstAdded",internalType:"uint256",type:"uint256"},{name:"pieceData",internalType:"struct Cids.Cid[]",type:"tuple[]",components:[{name:"data",internalType:"bytes",type:"bytes"}]},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"piecesAdded",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceIds",internalType:"uint256[]",type:"uint256[]"},{name:"extraData",internalType:"bytes",type:"bytes"}],name:"piecesScheduledRemove",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"},{name:"challengeCount",internalType:"uint256",type:"uint256"}],name:"possessionProven",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"terminator",internalType:"address",type:"address"},{name:"endEpoch",internalType:"uint256",type:"uint256"}],name:"railTerminated",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"index",internalType:"uint256",type:"uint256"}],name:"removeApprovedProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"serviceCommissionBps",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"serviceProviderRegistry",outputs:[{name:"",internalType:"contract ServiceProviderRegistry",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"sessionKeyRegistry",outputs:[{name:"",internalType:"contract SessionKeyRegistry",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"_viewContract",internalType:"address",type:"address"}],name:"setViewContract",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"oldServiceProvider",internalType:"address",type:"address"},{name:"newServiceProvider",internalType:"address",type:"address"},{name:"",internalType:"bytes",type:"bytes"}],name:"storageProviderChanged",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"terminateCDNService",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"terminateService",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newController",internalType:"address",type:"address"}],name:"transferFilCDNController",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newCommissionBps",internalType:"uint256",type:"uint256"}],name:"updateServiceCommission",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"function",inputs:[],name:"usdfcTokenAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"},{name:"proposedAmount",internalType:"uint256",type:"uint256"},{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"},{name:"",internalType:"uint256",type:"uint256"}],name:"validatePayment",outputs:[{name:"result",internalType:"struct IValidator.ValidationResult",type:"tuple",components:[{name:"modifiedAmount",internalType:"uint256",type:"uint256"},{name:"settleUpto",internalType:"uint256",type:"uint256"},{name:"note",internalType:"string",type:"string"}]}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"viewContractAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNPaymentTerminated"},{type:"event",anonymous:!1,inputs:[{name:"caller",internalType:"address",type:"address",indexed:!0},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"CDNServiceTerminated"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"payer",internalType:"address",type:"address",indexed:!1},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"payee",internalType:"address",type:"address",indexed:!1},{name:"metadataKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"metadataValues",internalType:"string[]",type:"string[]",indexed:!1}],name:"DataSetCreated"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"oldServiceProvider",internalType:"address",type:"address",indexed:!0},{name:"newServiceProvider",internalType:"address",type:"address",indexed:!0}],name:"DataSetServiceProviderChanged"},{type:"event",anonymous:!1,inputs:[],name:"EIP712DomainChanged"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"periodsFaulted",internalType:"uint256",type:"uint256",indexed:!1},{name:"deadline",internalType:"uint256",type:"uint256",indexed:!1}],name:"FaultRecord"},{type:"event",anonymous:!1,inputs:[{name:"oldController",internalType:"address",type:"address",indexed:!1},{name:"newController",internalType:"address",type:"address",indexed:!1}],name:"FilCDNControllerChanged"},{type:"event",anonymous:!1,inputs:[{name:"name",internalType:"string",type:"string",indexed:!1},{name:"description",internalType:"string",type:"string",indexed:!1}],name:"FilecoinServiceDeployed"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"endEpoch",internalType:"uint256",type:"uint256",indexed:!1},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"PDPPaymentTerminated"},{type:"event",anonymous:!1,inputs:[{name:"railId",internalType:"uint256",type:"uint256",indexed:!1},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!1},{name:"originalAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"modifiedAmount",internalType:"uint256",type:"uint256",indexed:!1},{name:"faultedEpochs",internalType:"uint256",type:"uint256",indexed:!1}],name:"PaymentArbitrated"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pieceId",internalType:"uint256",type:"uint256",indexed:!0},{name:"keys",internalType:"string[]",type:"string[]",indexed:!1},{name:"values",internalType:"string[]",type:"string[]",indexed:!1}],name:"PieceAdded"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderApproved"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderUnapproved"},{type:"event",anonymous:!1,inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"railId",internalType:"uint256",type:"uint256",indexed:!1},{name:"newRate",internalType:"uint256",type:"uint256",indexed:!1}],name:"RailRateUpdated"},{type:"event",anonymous:!1,inputs:[{name:"caller",internalType:"address",type:"address",indexed:!0},{name:"dataSetId",internalType:"uint256",type:"uint256",indexed:!0},{name:"pdpRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cacheMissRailId",internalType:"uint256",type:"uint256",indexed:!1},{name:"cdnRailId",internalType:"uint256",type:"uint256",indexed:!1}],name:"ServiceTerminated"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"event",anonymous:!1,inputs:[{name:"viewContract",internalType:"address",type:"address",indexed:!0}],name:"ViewContractSet"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expectedPayer",internalType:"address",type:"address"},{name:"expectedPayee",internalType:"address",type:"address"},{name:"caller",internalType:"address",type:"address"}],name:"CallerNotPayerOrPayee"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"CallerNotPayments"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"windowStart",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ChallengeWindowTooEarly"},{type:"error",inputs:[{name:"commissionType",internalType:"enum Errors.CommissionType",type:"uint8"},{name:"max",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"CommissionExceedsMaximum"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"DataSetNotFoundForRail"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"currentBlock",internalType:"uint256",type:"uint256"}],name:"DataSetPaymentBeyondEndEpoch"},{type:"error",inputs:[],name:"DivisionByZero"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"DuplicateMetadataKey"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"ExtraDataRequired"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"FilCDNPaymentAlreadyTerminated"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"FilCDNServiceNotConfigured"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minExpected",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeCount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"minAllowed",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"actual",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeEpoch"},{type:"error",inputs:[{name:"maxProvingPeriod",internalType:"uint256",type:"uint256"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"}],name:"InvalidChallengeWindowSize"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"InvalidDataSetId"},{type:"error",inputs:[{name:"fromEpoch",internalType:"uint256",type:"uint256"},{name:"toEpoch",internalType:"uint256",type:"uint256"}],name:"InvalidEpochRange"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"InvalidSignature"},{type:"error",inputs:[{name:"expectedLength",internalType:"uint256",type:"uint256"},{name:"actualLength",internalType:"uint256",type:"uint256"}],name:"InvalidSignatureLength"},{type:"error",inputs:[],name:"MaxProvingPeriodZero"},{type:"error",inputs:[{name:"metadataArrayCount",internalType:"uint256",type:"uint256"},{name:"pieceCount",internalType:"uint256",type:"uint256"}],name:"MetadataArrayCountMismatch"},{type:"error",inputs:[{name:"keysLength",internalType:"uint256",type:"uint256"},{name:"valuesLength",internalType:"uint256",type:"uint256"}],name:"MetadataKeyAndValueLengthMismatch"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataKeyExceedsMaxLength"},{type:"error",inputs:[{name:"index",internalType:"uint256",type:"uint256"},{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"length",internalType:"uint256",type:"uint256"}],name:"MetadataValueExceedsMaxLength"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodDeadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"NextProvingPeriodAlreadyCalled"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"NoPDPPaymentRail"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OldServiceProviderMismatch"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyFilCDNControllerAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlyPDPVerifierAllowed"},{type:"error",inputs:[{name:"expected",internalType:"address",type:"address"},{name:"actual",internalType:"address",type:"address"}],name:"OnlySelf"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"cdnEndEpoch",internalType:"uint256",type:"uint256"}],name:"PaymentRailsNotFinalized"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProofAlreadySubmitted"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderAlreadyApproved"},{type:"error",inputs:[{name:"provider",internalType:"address",type:"address"},{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderNotApproved"},{type:"error",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"ProviderNotInApprovedList"},{type:"error",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"ProviderNotRegistered"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingNotStarted"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"deadline",internalType:"uint256",type:"uint256"},{name:"nowBlock",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodPassed"},{type:"error",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"RailNotAssociated"},{type:"error",inputs:[],name:"ServiceContractMustTerminateRail"},{type:"error",inputs:[{name:"maxAllowed",internalType:"uint256",type:"uint256"},{name:"keysLength",internalType:"uint256",type:"uint256"}],name:"TooManyMetadataKeys"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"},{type:"error",inputs:[{name:"v",internalType:"uint8",type:"uint8"}],name:"UnsupportedSignatureV"},{type:"error",inputs:[{name:"field",internalType:"enum Errors.AddressField",type:"uint8"}],name:"ZeroAddress"}],WARM_STORAGE_VIEW:[{type:"constructor",inputs:[{name:"_service",internalType:"contract FilecoinWarmStorageService",type:"address"}],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"challengeWindow",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"}],name:"clientDataSetIDs",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"payer",internalType:"address",type:"address"}],name:"clientDataSets",outputs:[{name:"dataSetIds",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"filCDNControllerAddress",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getAllDataSetMetadata",outputs:[{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"}],name:"getAllPieceMetadata",outputs:[{name:"keys",internalType:"string[]",type:"string[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"getApprovedProviders",outputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[],name:"getChallengesPerProof",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"pure"},{type:"function",inputs:[{name:"client",internalType:"address",type:"address"}],name:"getClientDataSets",outputs:[{name:"infos",internalType:"struct FilecoinWarmStorageService.DataSetInfo[]",type:"tuple[]",components:[{name:"pdpRailId",internalType:"uint256",type:"uint256"},{name:"cacheMissRailId",internalType:"uint256",type:"uint256"},{name:"cdnRailId",internalType:"uint256",type:"uint256"},{name:"payer",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"commissionBps",internalType:"uint256",type:"uint256"},{name:"clientDataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"providerId",internalType:"uint256",type:"uint256"},{name:"cdnEndEpoch",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"getDataSet",outputs:[{name:"info",internalType:"struct FilecoinWarmStorageService.DataSetInfo",type:"tuple",components:[{name:"pdpRailId",internalType:"uint256",type:"uint256"},{name:"cacheMissRailId",internalType:"uint256",type:"uint256"},{name:"cdnRailId",internalType:"uint256",type:"uint256"},{name:"payer",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"serviceProvider",internalType:"address",type:"address"},{name:"commissionBps",internalType:"uint256",type:"uint256"},{name:"clientDataSetId",internalType:"uint256",type:"uint256"},{name:"pdpEndEpoch",internalType:"uint256",type:"uint256"},{name:"providerId",internalType:"uint256",type:"uint256"},{name:"cdnEndEpoch",internalType:"uint256",type:"uint256"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"getDataSetMetadata",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"leafCount",internalType:"uint256",type:"uint256"}],name:"getDataSetSizeInBytes",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"pure"},{type:"function",inputs:[],name:"getMaxProvingPeriod",outputs:[{name:"",internalType:"uint64",type:"uint64"}],stateMutability:"view"},{type:"function",inputs:[],name:"getPDPConfig",outputs:[{name:"maxProvingPeriod",internalType:"uint64",type:"uint64"},{name:"challengeWindowSize",internalType:"uint256",type:"uint256"},{name:"challengesPerProof",internalType:"uint256",type:"uint256"},{name:"initChallengeWindowStart",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"pieceId",internalType:"uint256",type:"uint256"},{name:"key",internalType:"string",type:"string"}],name:"getPieceMetadata",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"isProviderApproved",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"nextPDPChallengeWindowStart",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"},{name:"periodId",internalType:"uint256",type:"uint256"}],name:"provenPeriods",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"provenThisPeriod",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"provingActivationEpoch",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"setId",internalType:"uint256",type:"uint256"}],name:"provingDeadline",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"railId",internalType:"uint256",type:"uint256"}],name:"railToDataSet",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"service",outputs:[{name:"",internalType:"contract FilecoinWarmStorageService",type:"address"}],stateMutability:"view"},{type:"error",inputs:[{name:"dataSetId",internalType:"uint256",type:"uint256"}],name:"ProvingPeriodNotInitialized"}],MULTICALL3:[{inputs:[{components:[{name:"target",type:"address"},{name:"allowFailure",type:"bool"},{name:"callData",type:"bytes"}],name:"calls",type:"tuple[]"}],name:"aggregate3",outputs:[{components:[{name:"success",type:"bool"},{name:"returnData",type:"bytes"}],name:"returnData",type:"tuple[]"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentBlockTimestamp",outputs:[{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"}],SERVICE_PROVIDER_REGISTRY:[{type:"constructor",inputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"BURN_ACTOR",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITIES",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITY_KEY_LENGTH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"MAX_CAPABILITY_VALUE_LENGTH",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"REGISTRATION_FEE",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[],name:"VERSION",outputs:[{name:"",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"activeProductTypeProviderCount",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[],name:"activeProviderCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"productData",internalType:"bytes",type:"bytes"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"string[]",type:"string[]"}],name:"addProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"addressToProviderId",outputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"data",internalType:"bytes",type:"bytes"}],name:"decodePDPOffering",outputs:[{name:"",internalType:"struct ServiceProviderRegistryStorage.PDPOffering",type:"tuple",components:[{name:"serviceURL",internalType:"string",type:"string"},{name:"minPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"maxPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"ipniPiece",internalType:"bool",type:"bool"},{name:"ipniIpfs",internalType:"bool",type:"bool"},{name:"storagePricePerTibPerMonth",internalType:"uint256",type:"uint256"},{name:"minProvingPeriodInEpochs",internalType:"uint256",type:"uint256"},{name:"location",internalType:"string",type:"string"},{name:"paymentTokenAddress",internalType:"contract IERC20",type:"address"}]}],stateMutability:"pure"},{type:"function",inputs:[],name:"eip712Domain",outputs:[{name:"fields",internalType:"bytes1",type:"bytes1"},{name:"name",internalType:"string",type:"string"},{name:"version",internalType:"string",type:"string"},{name:"chainId",internalType:"uint256",type:"uint256"},{name:"verifyingContract",internalType:"address",type:"address"},{name:"salt",internalType:"bytes32",type:"bytes32"},{name:"extensions",internalType:"uint256[]",type:"uint256[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"pdpOffering",internalType:"struct ServiceProviderRegistryStorage.PDPOffering",type:"tuple",components:[{name:"serviceURL",internalType:"string",type:"string"},{name:"minPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"maxPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"ipniPiece",internalType:"bool",type:"bool"},{name:"ipniIpfs",internalType:"bool",type:"bool"},{name:"storagePricePerTibPerMonth",internalType:"uint256",type:"uint256"},{name:"minProvingPeriodInEpochs",internalType:"uint256",type:"uint256"},{name:"location",internalType:"string",type:"string"},{name:"paymentTokenAddress",internalType:"contract IERC20",type:"address"}]}],name:"encodePDPOffering",outputs:[{name:"",internalType:"bytes",type:"bytes"}],stateMutability:"pure"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getActiveProvidersByProductType",outputs:[{name:"result",internalType:"struct ServiceProviderRegistryStorage.PaginatedProviders",type:"tuple",components:[{name:"providers",internalType:"struct ServiceProviderRegistryStorage.ProviderWithProduct[]",type:"tuple[]",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"providerInfo",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"product",internalType:"struct ServiceProviderRegistryStorage.ServiceProduct",type:"tuple",components:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"productData",internalType:"bytes",type:"bytes"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}]}]},{name:"hasMore",internalType:"bool",type:"bool"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getAllActiveProviders",outputs:[{name:"providerIds",internalType:"uint256[]",type:"uint256[]"},{name:"hasMore",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"getNextProviderId",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"getPDPService",outputs:[{name:"pdpOffering",internalType:"struct ServiceProviderRegistryStorage.PDPOffering",type:"tuple",components:[{name:"serviceURL",internalType:"string",type:"string"},{name:"minPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"maxPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"ipniPiece",internalType:"bool",type:"bool"},{name:"ipniIpfs",internalType:"bool",type:"bool"},{name:"storagePricePerTibPerMonth",internalType:"uint256",type:"uint256"},{name:"minProvingPeriodInEpochs",internalType:"uint256",type:"uint256"},{name:"location",internalType:"string",type:"string"},{name:"paymentTokenAddress",internalType:"contract IERC20",type:"address"}]},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"getProduct",outputs:[{name:"productData",internalType:"bytes",type:"bytes"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"keys",internalType:"string[]",type:"string[]"}],name:"getProductCapabilities",outputs:[{name:"exists",internalType:"bool[]",type:"bool[]"},{name:"values",internalType:"string[]",type:"string[]"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"key",internalType:"string",type:"string"}],name:"getProductCapability",outputs:[{name:"exists",internalType:"bool",type:"bool"},{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"getProvider",outputs:[{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}],stateMutability:"view"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"getProviderByAddress",outputs:[{name:"info",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"getProviderCount",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerAddress",internalType:"address",type:"address"}],name:"getProviderIdByAddress",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"offset",internalType:"uint256",type:"uint256"},{name:"limit",internalType:"uint256",type:"uint256"}],name:"getProvidersByProductType",outputs:[{name:"result",internalType:"struct ServiceProviderRegistryStorage.PaginatedProviders",type:"tuple",components:[{name:"providers",internalType:"struct ServiceProviderRegistryStorage.ProviderWithProduct[]",type:"tuple[]",components:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"providerInfo",internalType:"struct ServiceProviderRegistryStorage.ServiceProviderInfo",type:"tuple",components:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}]},{name:"product",internalType:"struct ServiceProviderRegistryStorage.ServiceProduct",type:"tuple",components:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"productData",internalType:"bytes",type:"bytes"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"isActive",internalType:"bool",type:"bool"}]}]},{name:"hasMore",internalType:"bool",type:"bool"}]}],stateMutability:"view"},{type:"function",inputs:[],name:"initialize",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"isProviderActive",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"provider",internalType:"address",type:"address"}],name:"isRegisteredProvider",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"newVersion",internalType:"string",type:"string"}],name:"migrate",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"owner",outputs:[{name:"",internalType:"address",type:"address"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"key",internalType:"string",type:"string"}],name:"productCapabilities",outputs:[{name:"value",internalType:"string",type:"string"}],stateMutability:"view"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"productTypeProviderCount",outputs:[{name:"count",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"providerHasProduct",outputs:[{name:"",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"providerProducts",outputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"productData",internalType:"bytes",type:"bytes"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],name:"providers",outputs:[{name:"serviceProvider",internalType:"address",type:"address"},{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"isActive",internalType:"bool",type:"bool"}],stateMutability:"view"},{type:"function",inputs:[],name:"proxiableUUID",outputs:[{name:"",internalType:"bytes32",type:"bytes32"}],stateMutability:"view"},{type:"function",inputs:[{name:"payee",internalType:"address",type:"address"},{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"productData",internalType:"bytes",type:"bytes"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"string[]",type:"string[]"}],name:"registerProvider",outputs:[{name:"providerId",internalType:"uint256",type:"uint256"}],stateMutability:"payable"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"}],name:"removeProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"removeProvider",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newOwner",internalType:"address",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"pdpOffering",internalType:"struct ServiceProviderRegistryStorage.PDPOffering",type:"tuple",components:[{name:"serviceURL",internalType:"string",type:"string"},{name:"minPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"maxPieceSizeInBytes",internalType:"uint256",type:"uint256"},{name:"ipniPiece",internalType:"bool",type:"bool"},{name:"ipniIpfs",internalType:"bool",type:"bool"},{name:"storagePricePerTibPerMonth",internalType:"uint256",type:"uint256"},{name:"minProvingPeriodInEpochs",internalType:"uint256",type:"uint256"},{name:"location",internalType:"string",type:"string"},{name:"paymentTokenAddress",internalType:"contract IERC20",type:"address"}]},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"string[]",type:"string[]"}],name:"updatePDPServiceWithCapabilities",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8"},{name:"productData",internalType:"bytes",type:"bytes"},{name:"capabilityKeys",internalType:"string[]",type:"string[]"},{name:"capabilityValues",internalType:"string[]",type:"string[]"}],name:"updateProduct",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"name",internalType:"string",type:"string"},{name:"description",internalType:"string",type:"string"}],name:"updateProviderInfo",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"newImplementation",internalType:"address",type:"address"},{name:"data",internalType:"bytes",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"string",type:"string",indexed:!1},{name:"implementation",internalType:"address",type:"address",indexed:!1}],name:"ContractUpgraded"},{type:"event",anonymous:!1,inputs:[],name:"EIP712DomainChanged"},{type:"event",anonymous:!1,inputs:[{name:"version",internalType:"uint64",type:"uint64",indexed:!1}],name:"Initialized"},{type:"event",anonymous:!1,inputs:[{name:"previousOwner",internalType:"address",type:"address",indexed:!0},{name:"newOwner",internalType:"address",type:"address",indexed:!0}],name:"OwnershipTransferred"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0},{name:"serviceUrl",internalType:"string",type:"string",indexed:!1},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"capabilityKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"capabilityValues",internalType:"string[]",type:"string[]",indexed:!1}],name:"ProductAdded"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0}],name:"ProductRemoved"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"productType",internalType:"enum ServiceProviderRegistryStorage.ProductType",type:"uint8",indexed:!0},{name:"serviceUrl",internalType:"string",type:"string",indexed:!1},{name:"serviceProvider",internalType:"address",type:"address",indexed:!1},{name:"capabilityKeys",internalType:"string[]",type:"string[]",indexed:!1},{name:"capabilityValues",internalType:"string[]",type:"string[]",indexed:!1}],name:"ProductUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderInfoUpdated"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0},{name:"serviceProvider",internalType:"address",type:"address",indexed:!0},{name:"payee",internalType:"address",type:"address",indexed:!0}],name:"ProviderRegistered"},{type:"event",anonymous:!1,inputs:[{name:"providerId",internalType:"uint256",type:"uint256",indexed:!0}],name:"ProviderRemoved"},{type:"event",anonymous:!1,inputs:[{name:"implementation",internalType:"address",type:"address",indexed:!0}],name:"Upgraded"},{type:"error",inputs:[{name:"target",internalType:"address",type:"address"}],name:"AddressEmptyCode"},{type:"error",inputs:[{name:"implementation",internalType:"address",type:"address"}],name:"ERC1967InvalidImplementation"},{type:"error",inputs:[],name:"ERC1967NonPayable"},{type:"error",inputs:[],name:"FailedCall"},{type:"error",inputs:[],name:"InvalidInitialization"},{type:"error",inputs:[],name:"NotInitializing"},{type:"error",inputs:[{name:"owner",internalType:"address",type:"address"}],name:"OwnableInvalidOwner"},{type:"error",inputs:[{name:"account",internalType:"address",type:"address"}],name:"OwnableUnauthorizedAccount"},{type:"error",inputs:[],name:"UUPSUnauthorizedCallContext"},{type:"error",inputs:[{name:"slot",internalType:"bytes32",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID"}],SESSION_KEY_REGISTRY:[{type:"function",inputs:[{name:"user",internalType:"address",type:"address"},{name:"signer",internalType:"address",type:"address"},{name:"permission",internalType:"bytes32",type:"bytes32"}],name:"authorizationExpiry",outputs:[{name:"",internalType:"uint256",type:"uint256"}],stateMutability:"view"},{type:"function",inputs:[{name:"signer",internalType:"address",type:"address"},{name:"expiry",internalType:"uint256",type:"uint256"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"}],name:"login",outputs:[],stateMutability:"nonpayable"},{type:"function",inputs:[{name:"signer",internalType:"address payable",type:"address"},{name:"expiry",internalType:"uint256",type:"uint256"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"}],name:"loginAndFund",outputs:[],stateMutability:"payable"},{type:"function",inputs:[{name:"signer",internalType:"address",type:"address"},{name:"permissions",internalType:"bytes32[]",type:"bytes32[]"}],name:"revoke",outputs:[],stateMutability:"nonpayable"}]},m={EPOCH_DURATION:30,EPOCHS_PER_DAY:2880n,EPOCHS_PER_MONTH:86400n,DAYS_PER_MONTH:30n,DEFAULT_LOCKUP_DAYS:10n},h={mainnet:1598306400,calibration:1667326380},f={KiB:1024n,MiB:1048576n,GiB:1073741824n,TiB:1099511627776n,MAX_UPLOAD_SIZE:209715200,MIN_UPLOAD_SIZE:127,DEFAULT_UPLOAD_BATCH_SIZE:32},g={TRANSACTION_PROPAGATION_TIMEOUT_MS:3e4,TRANSACTION_PROPAGATION_POLL_INTERVAL_MS:2e3,DATA_SET_CREATION_TIMEOUT_MS:42e4,DATA_SET_CREATION_POLL_INTERVAL_MS:2e3,PIECE_PARKING_TIMEOUT_MS:42e4,PIECE_PARKING_POLL_INTERVAL_MS:5e3,TRANSACTION_CONFIRMATIONS:1,PIECE_ADDITION_TIMEOUT_MS:42e4,PIECE_ADDITION_POLL_INTERVAL_MS:1e3},v={mainnet:{http:"https://api.node.glif.io/rpc/v1",websocket:"wss://wss.node.glif.io/apigw/lotus/rpc/v1"},calibration:{http:"https://api.calibration.node.glif.io/rpc/v1",websocket:"wss://wss.calibration.node.glif.io/apigw/lotus/rpc/v1"}},w={WARM_STORAGE:{mainnet:"",calibration:"0x80617b65FD2EEa1D7fDe2B4F85977670690ed348"},MULTICALL3:{mainnet:"0xcA11bde05977b3631167028862bE2a173976CA11",calibration:"0xcA11bde05977b3631167028862bE2a173976CA11"},USDFC:{mainnet:"0x80B98d3aa09ffff255c3ba4A241111Ff1262F045",calibration:"0xb3042734b608a1B16e9e86B374A3f3e389B4cDf0"}};function T(e,t,n,r){let i=`${e} ${t} failed: ${n}`;return null!=r&&r instanceof Error&&(i=`${i} - ${r.message}`),null!=r?new Error(i,{cause:r}):new Error(i)}function S(e,t){const n=h[t],r=m.EPOCH_DURATION;return new Date(1e3*(n+e*r))}function P(e,t){const n=h[t],r=m.EPOCH_DURATION,i=Math.floor(e.getTime()/1e3)-n;return Math.floor(i/r)}function b(e){return h[e]}function I(e,t){const n=e-t,r=n*m.EPOCH_DURATION;return{epochs:n,seconds:r,minutes:r/60,hours:r/3600,days:r/86400}}function C(e,t,n){if(0===e)return null;const r=e-t;return r<=0?null:S(r,n)}async function A(e){const t=await e.getBlockNumber();if(null==t)throw T("epoch","getCurrentEpoch","Failed to get latest block number");return BigInt(t)}async function D(e){try{const t=await e.getNetwork(),n=Number(t.chainId);if(n===y.mainnet)return"mainnet";if(n===y.calibration)return"calibration";throw T("NetworkUtils","getFilecoinNetworkType",`Unsupported network: chain ID ${n}. Only Filecoin mainnet (${y.mainnet}) and calibration (${y.calibration}) are supported.`)}catch(e){if(e instanceof Error&&e.message.includes("Unsupported network"))throw e;throw T("NetworkUtils","getFilecoinNetworkType",`Failed to detect network: ${e instanceof Error?e.message:String(e)}`)}}function _(e,t){return`${e.replace(/\/$/,"")}/piece/${t.toString()}`}function E(e,t){return`${e.replace(/\/$/,"")}/pdp/piece?${new URLSearchParams({pieceCid:t.toString()}).toString()}`}class x{_provider;_signer;_paymentsAddress;_usdfcAddress;_disableNonceManager;_usdfcContract=null;_paymentsContract=null;constructor(e,t,n,r,i){this._provider=e,this._signer=t,this._paymentsAddress=n,this._usdfcAddress=r,this._disableNonceManager=i}_getUsdfcContract(){return null==this._usdfcContract&&(this._usdfcContract=new u.ethers.Contract(this._usdfcAddress,c.ERC20,this._signer)),this._usdfcContract}_getPaymentsContract(){return null==this._paymentsContract&&(this._paymentsContract=new u.ethers.Contract(this._paymentsAddress,c.PAYMENTS,this._signer)),this._paymentsContract}async balance(e=l.USDFC){if(e!==l.USDFC)throw T("PaymentsService","payments contract balance check",`Token "${e}" is not supported. Currently only USDFC token is supported for payments contract balance queries.`);return(await this.accountInfo(e)).availableFunds}async accountInfo(e=l.USDFC){if(e!==l.USDFC)throw T("PaymentsService","account info",`Token "${e}" is not supported. Currently only USDFC token is supported.`);const t=await this._signer.getAddress(),n=this._getPaymentsContract();let r;try{r=await n.accounts(this._usdfcAddress,t)}catch(e){throw T("PaymentsService","account info","Failed to read account information from payments contract. This could indicate the contract is not properly deployed, the ABI is incorrect, or there are network connectivity issues.",e)}const[i,a,s,o]=r,p=await A(this._provider)-BigInt(o),d=BigInt(a)+BigInt(s)*p,u=BigInt(i)-d;return{funds:BigInt(i),lockupCurrent:BigInt(a),lockupRate:BigInt(s),lockupLastSettledAt:BigInt(o),availableFunds:u>0n?u:0n}}async walletBalance(e){if(null==e||e===l.FIL)try{const e=await this._signer.getAddress();return await this._provider.getBalance(e)}catch(e){throw T("PaymentsService","wallet FIL balance check","Unable to retrieve FIL balance from wallet. This could be due to network connectivity issues, RPC endpoint problems, or wallet connection issues.",e)}if(e===l.USDFC)try{const e=await this._signer.getAddress(),t=this._getUsdfcContract();return await t.balanceOf(e)}catch(e){throw T("PaymentsService","wallet USDFC balance check","Unexpected error while checking USDFC token balance in wallet.",e)}throw T("PaymentsService","wallet balance",`Token "${e}" is not supported. Currently only FIL and USDFC tokens are supported.`)}decimals(e=l.USDFC){return 18}async allowance(e,t=l.USDFC){if(t!==l.USDFC)throw T("PaymentsService","allowance",`Token "${t}" is not supported. Currently only USDFC token is supported.`);const n=await this._signer.getAddress(),r=this._getUsdfcContract();try{return await r.allowance(n,e)}catch(e){throw T("PaymentsService","allowance check","Failed to check token allowance. This could indicate network connectivity issues or an invalid spender address.",e)}}async approve(e,t,n=l.USDFC){if(n!==l.USDFC)throw T("PaymentsService","approve",`Token "${n}" is not supported. Currently only USDFC token is supported.`);const r="bigint"==typeof t?t:BigInt(t);if(r<0n)throw T("PaymentsService","approve","Approval amount cannot be negative");const i=await this._signer.getAddress(),a=this._getUsdfcContract(),s={};if(this._disableNonceManager){const e=await this._provider.getTransactionCount(i,"pending");s.nonce=e}try{return await a.approve(e,r,s)}catch(t){throw T("PaymentsService","approve",`Failed to approve ${e} to spend ${r.toString()} ${n}`,t)}}async approveService(e,t,n,r,i=l.USDFC){if(i!==l.USDFC)throw T("PaymentsService","approveService",`Token "${i}" is not supported. Currently only USDFC token is supported.`);const a="bigint"==typeof t?t:BigInt(t),s="bigint"==typeof n?n:BigInt(n),o="bigint"==typeof r?r:BigInt(r);if(a<0n||s<0n||o<0n)throw T("PaymentsService","approveService","Allowance values cannot be negative");const p=await this._signer.getAddress(),d=this._getPaymentsContract(),u={};if(this._disableNonceManager){const e=await this._provider.getTransactionCount(p,"pending");u.nonce=e}try{return await d.setOperatorApproval(this._usdfcAddress,e,!0,a,s,o,u)}catch(t){throw T("PaymentsService","approveService",`Failed to approve service ${e} as operator for ${i}`,t)}}async revokeService(e,t=l.USDFC){if(t!==l.USDFC)throw T("PaymentsService","revokeService",`Token "${t}" is not supported. Currently only USDFC token is supported.`);const n=await this._signer.getAddress(),r=this._getPaymentsContract(),i={};if(this._disableNonceManager){const e=await this._provider.getTransactionCount(n,"pending");i.nonce=e}try{return await r.setOperatorApproval(this._usdfcAddress,e,!1,0n,0n,0n,i)}catch(n){throw T("PaymentsService","revokeService",`Failed to revoke service ${e} as operator for ${t}`,n)}}async serviceApproval(e,t=l.USDFC){if(t!==l.USDFC)throw T("PaymentsService","serviceApproval",`Token "${t}" is not supported. Currently only USDFC token is supported.`);const n=await this._signer.getAddress(),r=this._getPaymentsContract();try{const t=await r.operatorApprovals(this._usdfcAddress,n,e);return{isApproved:t[0],rateAllowance:t[1],lockupAllowance:t[2],rateUsed:t[3],lockupUsed:t[4],maxLockupPeriod:t[5]}}catch(t){throw T("PaymentsService","serviceApproval",`Failed to check service approval status for ${e}`,t)}}async deposit(e,t=l.USDFC,n){if(t!==l.USDFC)throw T("PaymentsService","deposit",`Unsupported token: ${t}`);const r="bigint"==typeof e?e:BigInt(e);if(r<=0n)throw T("PaymentsService","deposit","Invalid amount");const i=await this._signer.getAddress(),a=this._getUsdfcContract(),s=this._getPaymentsContract(),o=await a.balanceOf(i);if(o<r)throw T("PaymentsService","deposit",`Insufficient USDFC: have ${BigInt(o).toString()}, need ${r.toString()}`);const p=await this.allowance(this._paymentsAddress,t);if(n?.onAllowanceCheck?.(p,r),p<r){const e=await this.approve(this._paymentsAddress,r,t);n?.onApprovalTransaction?.(e);const i=await e.wait(g.TRANSACTION_CONFIRMATIONS);null!=i&&n?.onApprovalConfirmed?.(i)}n?.onDepositStarting?.();const d={};if(this._disableNonceManager){const e=await this._provider.getTransactionCount(i,"pending");d.nonce=e}return await s.deposit(this._usdfcAddress,i,r,d)}async withdraw(e,t=l.USDFC){if(t!==l.USDFC)throw T("PaymentsService","withdraw",`Unsupported token: ${t}`);const n="bigint"==typeof e?e:BigInt(e);if(n<=0n)throw T("PaymentsService","withdraw","Invalid amount");const r=await this._signer.getAddress(),i=this._getPaymentsContract(),a=await this.accountInfo(t);if(a.availableFunds<n)throw T("PaymentsService","withdraw",`Insufficient available balance: have ${a.availableFunds.toString()}, need ${n.toString()}`);const s={};if(this._disableNonceManager){const e=await this._provider.getTransactionCount(r,"pending");s.nonce=e}return await i.withdraw(this._usdfcAddress,n,s)}}async function R(e,t){const n=Nn(t);if(null==n)throw new Error(`Invalid PieceCID: ${String(t)}`);if(!e.ok)throw new Error(`Download failed: ${e.status} ${e.statusText}`);if(null==e.body)throw new Error("Response body is null");const{stream:r,getPieceCID:i}=Fn(),a=[],s=new TransformStream({transform(e,t){a.push(e),t.enqueue(e)}}),o=e.body.pipeThrough(r).pipeThrough(s).getReader();try{for(;;){const{done:e}=await o.read();if(e)break}}finally{o.releaseLock()}if(0===a.length)throw new Error("Response body is null");const p=i();if(null==p)throw new Error("Failed to calculate PieceCID from stream");if(p.toString()!==n.toString())throw new Error(`PieceCID verification failed. Expected: ${String(n)}, Got: ${String(p)}`);const d=a.reduce((e,t)=>e+t.length,0),u=new Uint8Array(d);let l=0;for(const e of a)u.set(e,l),l+=e.length;return u}async function M(e,t){const n=await fetch(e);return await R(n,t)}BigInt(4);const k=127,N=BigInt(k),U=(BigInt(128),.9921875),O=32,F=BigInt(O),$=()=>L,L=(e=>{if(e instanceof Uint8Array){if(e.length>O)return e.subarray(0,O);if(e.length==O)return e}const t=new Uint8Array(O);return t.set([...e]),t})(new Uint8Array(O).fill(0));Object.freeze(L.buffer);const B=new Uint8Array(0);function z(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}function V(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function W(e,t){!function(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const j=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),H=(e,t)=>e<<32-t|e>>>t;if(68!==new Uint8Array(new Uint32Array([287454020]).buffer)[0])throw new Error("Non little-endian hardware is not supported");function G(e){if("string"==typeof e&&(e=function(e){if("string"!=typeof e)throw new Error("utf8ToBytes expected string, got "+typeof e);return new Uint8Array((new TextEncoder).encode(e))}(e)),!(e instanceof Uint8Array))throw new Error("expected Uint8Array, got "+typeof e);return e}class K{clone(){return this._cloneInto()}}function q(e){const t=t=>e().update(G(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}class Z extends K{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=j(this.buffer)}update(e){V(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=G(e)).length;for(let a=0;a<i;){const s=Math.min(r-this.pos,i-a);if(s===r){const t=j(e);for(;r<=i-a;a+=r)this.process(t,a);continue}n.set(e.subarray(a,a+s),this.pos),this.pos+=s,a+=s,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){V(this),W(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:a}=this;t[a++]=128,this.buffer.subarray(a).fill(0),this.padOffset>r-a&&(this.process(n,0),a=0);for(let e=a;e<r;e++)t[e]=0;!function(e,t,n,r){if("function"==typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),a=BigInt(4294967295),s=Number(n>>i&a),o=Number(n&a),p=r?4:0,d=r?0:4;e.setUint32(t+p,s,r),e.setUint32(t+d,o,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=j(e),o=this.outputLen;if(o%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const p=o/4,d=this.get();if(p>d.length)throw new Error("_sha2: outputLen bigger than state");for(let e=0;e<p;e++)s.setUint32(4*e,d[e],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:a,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=a,r%t&&e.buffer.set(n),e}}const Q=(e,t,n)=>e&t^~e&n,Y=(e,t,n)=>e&t^e&n^t&n,X=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),J=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ee=new Uint32Array(64);class te extends Z{constructor(){super(64,32,8,!1),this.A=0|J[0],this.B=0|J[1],this.C=0|J[2],this.D=0|J[3],this.E=0|J[4],this.F=0|J[5],this.G=0|J[6],this.H=0|J[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:a,G:s,H:o}=this;return[e,t,n,r,i,a,s,o]}set(e,t,n,r,i,a,s,o){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|a,this.G=0|s,this.H=0|o}process(e,t){for(let n=0;n<16;n++,t+=4)ee[n]=e.getUint32(t,!1);for(let e=16;e<64;e++){const t=ee[e-15],n=ee[e-2],r=H(t,7)^H(t,18)^t>>>3,i=H(n,17)^H(n,19)^n>>>10;ee[e]=i+ee[e-7]+r+ee[e-16]|0}let{A:n,B:r,C:i,D:a,E:s,F:o,G:p,H:d}=this;for(let e=0;e<64;e++){const t=d+(H(s,6)^H(s,11)^H(s,25))+Q(s,o,p)+X[e]+ee[e]|0,u=(H(n,2)^H(n,13)^H(n,22))+Y(n,r,i)|0;d=p,p=o,o=s,s=a+t|0,a=i,i=r,r=n,n=t+u|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,a=a+this.D|0,s=s+this.E|0,o=o+this.F|0,p=p+this.G|0,d=d+this.H|0,this.set(n,r,i,a,s,o,p,d)}roundClean(){ee.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const ne=q(()=>new te),re="sha2-256",ie=32,ae=new Uint8Array([18,32]);class se{constructor(e){this.code=18,this.name=re,this.bytes=e,this.size=ie,this.digest=e.subarray(2)}}const oe=e=>{const t=new Uint8Array(ae.length+ie);return t.set(ae,0),t.set(ne(e),ae.length),new se(t)},pe=18,de=["string","number","bigint","symbol"],ue=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];class le{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}le.uint=new le(0,"uint",!0),le.negint=new le(1,"negint",!0),le.bytes=new le(2,"bytes",!0),le.string=new le(3,"string",!0),le.array=new le(4,"array",!1),le.map=new le(5,"map",!1),le.tag=new le(6,"tag",!1),le.float=new le(7,"float",!0),le.false=new le(7,"false",!0),le.true=new le(7,"true",!0),le.null=new le(7,"null",!0),le.undefined=new le(7,"undefined",!0),le.break=new le(7,"break",!0);class ye{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const ce=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"==typeof globalThis.Buffer.isBuffer,me=new TextDecoder,he=new TextEncoder;function fe(e){return ce&&globalThis.Buffer.isBuffer(e)}const ge=ce?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):be(e,t,n):(e,t,n)=>n-t>64?me.decode(e.subarray(t,n)):be(e,t,n),ve=ce?e=>e.length>64?globalThis.Buffer.from(e):Pe(e):e=>e.length>64?he.encode(e):Pe(e),we=ce?(e,t,n)=>fe(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),Te=ce?(e,t)=>{return e=e.map(e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e)),(n=globalThis.Buffer.concat(e,t))instanceof Uint8Array?fe(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n:Uint8Array.from(n);var n}:(e,t)=>{const n=new Uint8Array(t);let r=0;for(let t of e)r+t.length>n.length&&(t=t.subarray(0,n.length-r)),n.set(t,r),r+=t.length;return n},Se=ce?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Pe(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}function be(e,t,n){const r=[];for(;t<n;){const i=e[t];let a=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=n){let n,r,o,p;switch(s){case 1:i<128&&(a=i);break;case 2:n=e[t+1],128==(192&n)&&(p=(31&i)<<6|63&n,p>127&&(a=p));break;case 3:n=e[t+1],r=e[t+2],128==(192&n)&&128==(192&r)&&(p=(15&i)<<12|(63&n)<<6|63&r,p>2047&&(p<55296||p>57343)&&(a=p));break;case 4:n=e[t+1],r=e[t+2],o=e[t+3],128==(192&n)&&128==(192&r)&&128==(192&o)&&(p=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&o,p>65535&&p<1114112&&(a=p))}}null===a?(a=65533,s=1):a>65535&&(a-=65536,r.push(a>>>10&1023|55296),a=56320|1023&a),r.push(a),t+=s}return function(e){const t=e.length;if(t<=Ie)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=Ie));return n}(r)}const Ie=4096;const Ce="CBOR decode error:",Ae="CBOR encode error:",De=[];function _e(e,t,n){if(e.length-t<n)throw new Error(`${Ce} not enough data for type`)}De[23]=1,De[24]=2,De[25]=3,De[26]=5,De[27]=9;const Ee=[24,256,65536,4294967296,BigInt("18446744073709551616")];function xe(e,t,n){_e(e,t,1);const r=e[t];if(!0===n.strict&&r<Ee[0])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return r}function Re(e,t,n){_e(e,t,2);const r=e[t]<<8|e[t+1];if(!0===n.strict&&r<Ee[1])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return r}function Me(e,t,n){_e(e,t,4);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<Ee[2])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);return r}function ke(e,t,n){_e(e,t,8);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],a=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&a<Ee[3])throw new Error(`${Ce} integer encoded in more bytes than necessary (strict decode)`);if(a<=Number.MAX_SAFE_INTEGER)return Number(a);if(!0===n.allowBigInt)return a;throw new Error(`${Ce} integers outside of the safe integer range are not supported`)}function Ne(e,t){return Ue(e,0,t.value)}function Ue(e,t,n){if(n<Ee[0]){const r=Number(n);e.push([t|r])}else if(n<Ee[1]){const r=Number(n);e.push([24|t,r])}else if(n<Ee[2]){const r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<Ee[3]){const r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<Ee[4]))throw new Error(`${Ce} encountered BigInt larger than allowable range`);{const n=[27|t,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),a=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&a,a>>=8,n[3]=255&a,a>>=8,n[2]=255&a,a>>=8,n[1]=255&a,e.push(n)}}}Ne.encodedSize=function(e){return Ue.encodedSize(e.value)},Ue.encodedSize=function(e){return e<Ee[0]?1:e<Ee[1]?2:e<Ee[2]?3:e<Ee[3]?5:9},Ne.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Oe=BigInt(-1),Fe=BigInt(1);function $e(e,t){const n=t.value,r="bigint"==typeof n?n*Oe-Fe:-1*n-1;Ue(e,t.type.majorEncoded,r)}function Le(e,t,n,r){_e(e,t,n+r);const i=we(e,t+n,t+n+r);return new ye(le.bytes,i,n+r)}function Be(e,t,n,r){return Le(e,t,1,n)}function ze(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===le.string?ve(e.value):e.value),e.encodedBytes}function Ve(e,t){const n=ze(t);Ue(e,t.type.majorEncoded,n.length),e.push(n)}function We(e,t,n,r,i){const a=n+r;_e(e,t,a);const s=new ye(le.string,ge(e,t+n,t+a),a);return!0===i.retainStringBytes&&(s.byteValue=we(e,t+n,t+a)),s}function je(e,t,n,r){return We(e,t,1,n,r)}$e.encodedSize=function(e){const t=e.value,n="bigint"==typeof t?t*Oe-Fe:-1*t-1;return n<Ee[0]?1:n<Ee[1]?2:n<Ee[2]?3:n<Ee[3]?5:9},$e.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Ve.encodedSize=function(e){const t=ze(e);return Ue.encodedSize(t.length)+t.length},Ve.compareTokens=function(e,t){return n=ze(e),r=ze(t),n.length<r.length?-1:n.length>r.length?1:function(e,t){if(fe(e)&&fe(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}(n,r);var n,r};const He=Ve;function Ge(e,t,n,r){return new ye(le.array,r,n)}function Ke(e,t,n,r){return Ge(0,0,1,n)}function qe(e,t){Ue(e,le.array.majorEncoded,t.value)}function Ze(e,t,n,r){return new ye(le.map,r,n)}function Qe(e,t,n,r){return Ze(0,0,1,n)}function Ye(e,t){Ue(e,le.map.majorEncoded,t.value)}function Xe(e,t,n,r){return new ye(le.tag,n,1)}function Je(e,t){Ue(e,le.tag.majorEncoded,t.value)}function et(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error(`${Ce} NaN values are not supported`);if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${Ce} Infinity values are not supported`)}return new ye(le.float,e,t)}function tt(e,t,n){const r=t.value;if(!1===r)e.push([20|le.float.majorEncoded]);else if(!0===r)e.push([21|le.float.majorEncoded]);else if(null===r)e.push([22|le.float.majorEncoded]);else if(void 0===r)e.push([23|le.float.majorEncoded]);else{let t,a=!1;n&&!0===n.float64||(at(r),t=st(it,1),r===t||Number.isNaN(r)?(it[0]=249,e.push(it.slice(0,3)),a=!0):(ot(r),t=pt(it,1),r===t&&(it[0]=250,e.push(it.slice(0,5)),a=!0))),a||(i=r,rt.setFloat64(0,i,!1),t=dt(it,1),it[0]=251,e.push(it.slice(0,9)))}var i}qe.compareTokens=Ne.compareTokens,qe.encodedSize=function(e){return Ue.encodedSize(e.value)},Ye.compareTokens=Ne.compareTokens,Ye.encodedSize=function(e){return Ue.encodedSize(e.value)},Je.compareTokens=Ne.compareTokens,Je.encodedSize=function(e){return Ue.encodedSize(e.value)},tt.encodedSize=function(e,t){const n=e.value;if(!1===n||!0===n||null==n)return 1;if(!t||!0!==t.float64){at(n);let e=st(it,1);if(n===e||Number.isNaN(n))return 3;if(ot(n),e=pt(it,1),n===e)return 5}return 9};const nt=new ArrayBuffer(9),rt=new DataView(nt,1),it=new Uint8Array(nt,0);function at(e){if(e===1/0)rt.setUint16(0,31744,!1);else if(e===-1/0)rt.setUint16(0,64512,!1);else if(Number.isNaN(e))rt.setUint16(0,32256,!1);else{rt.setFloat32(0,e);const t=rt.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)rt.setUint16(0,31744,!1);else if(0===n)rt.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=n-127;e<-24?rt.setUint16(0,0):e<-14?rt.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):rt.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function st(e,t){if(e.length-t<2)throw new Error(`${Ce} not enough data for float16`);const n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let a;return a=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-a:a}function ot(e){rt.setFloat32(0,e,!1)}function pt(e,t){if(e.length-t<4)throw new Error(`${Ce} not enough data for float32`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function dt(e,t){if(e.length-t<8)throw new Error(`${Ce} not enough data for float64`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function ut(e,t,n){throw new Error(`${Ce} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function lt(e){return()=>{throw new Error(`${Ce} ${e}`)}}tt.compareTokens=Ne.compareTokens;const yt=[];for(let e=0;e<=23;e++)yt[e]=ut;yt[24]=function(e,t,n,r){return new ye(le.uint,xe(e,t+1,r),2)},yt[25]=function(e,t,n,r){return new ye(le.uint,Re(e,t+1,r),3)},yt[26]=function(e,t,n,r){return new ye(le.uint,Me(e,t+1,r),5)},yt[27]=function(e,t,n,r){return new ye(le.uint,ke(e,t+1,r),9)},yt[28]=ut,yt[29]=ut,yt[30]=ut,yt[31]=ut;for(let e=32;e<=55;e++)yt[e]=ut;yt[56]=function(e,t,n,r){return new ye(le.negint,-1-xe(e,t+1,r),2)},yt[57]=function(e,t,n,r){return new ye(le.negint,-1-Re(e,t+1,r),3)},yt[58]=function(e,t,n,r){return new ye(le.negint,-1-Me(e,t+1,r),5)},yt[59]=function(e,t,n,r){const i=ke(e,t+1,r);if("bigint"!=typeof i){const e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new ye(le.negint,e,9)}if(!0!==r.allowBigInt)throw new Error(`${Ce} integers outside of the safe integer range are not supported`);return new ye(le.negint,Oe-BigInt(i),9)},yt[60]=ut,yt[61]=ut,yt[62]=ut,yt[63]=ut;for(let e=64;e<=87;e++)yt[e]=Be;yt[88]=function(e,t,n,r){return Le(e,t,2,xe(e,t+1,r))},yt[89]=function(e,t,n,r){return Le(e,t,3,Re(e,t+1,r))},yt[90]=function(e,t,n,r){return Le(e,t,5,Me(e,t+1,r))},yt[91]=function(e,t,n,r){const i=ke(e,t+1,r);if("bigint"==typeof i)throw new Error(`${Ce} 64-bit integer bytes lengths not supported`);return Le(e,t,9,i)},yt[92]=ut,yt[93]=ut,yt[94]=ut,yt[95]=lt("indefinite length bytes/strings are not supported");for(let e=96;e<=119;e++)yt[e]=je;yt[120]=function(e,t,n,r){return We(e,t,2,xe(e,t+1,r),r)},yt[121]=function(e,t,n,r){return We(e,t,3,Re(e,t+1,r),r)},yt[122]=function(e,t,n,r){return We(e,t,5,Me(e,t+1,r),r)},yt[123]=function(e,t,n,r){const i=ke(e,t+1,r);if("bigint"==typeof i)throw new Error(`${Ce} 64-bit integer string lengths not supported`);return We(e,t,9,i,r)},yt[124]=ut,yt[125]=ut,yt[126]=ut,yt[127]=lt("indefinite length bytes/strings are not supported");for(let e=128;e<=151;e++)yt[e]=Ke;yt[152]=function(e,t,n,r){return Ge(0,0,2,xe(e,t+1,r))},yt[153]=function(e,t,n,r){return Ge(0,0,3,Re(e,t+1,r))},yt[154]=function(e,t,n,r){return Ge(0,0,5,Me(e,t+1,r))},yt[155]=function(e,t,n,r){const i=ke(e,t+1,r);if("bigint"==typeof i)throw new Error(`${Ce} 64-bit integer array lengths not supported`);return Ge(0,0,9,i)},yt[156]=ut,yt[157]=ut,yt[158]=ut,yt[159]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${Ce} indefinite length items not allowed`);return Ge(0,0,1,1/0)};for(let e=160;e<=183;e++)yt[e]=Qe;yt[184]=function(e,t,n,r){return Ze(0,0,2,xe(e,t+1,r))},yt[185]=function(e,t,n,r){return Ze(0,0,3,Re(e,t+1,r))},yt[186]=function(e,t,n,r){return Ze(0,0,5,Me(e,t+1,r))},yt[187]=function(e,t,n,r){const i=ke(e,t+1,r);if("bigint"==typeof i)throw new Error(`${Ce} 64-bit integer map lengths not supported`);return Ze(0,0,9,i)},yt[188]=ut,yt[189]=ut,yt[190]=ut,yt[191]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${Ce} indefinite length items not allowed`);return Ze(0,0,1,1/0)};for(let e=192;e<=215;e++)yt[e]=Xe;yt[216]=function(e,t,n,r){return new ye(le.tag,xe(e,t+1,r),2)},yt[217]=function(e,t,n,r){return new ye(le.tag,Re(e,t+1,r),3)},yt[218]=function(e,t,n,r){return new ye(le.tag,Me(e,t+1,r),5)},yt[219]=function(e,t,n,r){return new ye(le.tag,ke(e,t+1,r),9)},yt[220]=ut,yt[221]=ut,yt[222]=ut,yt[223]=ut;for(let e=224;e<=243;e++)yt[e]=lt("simple values are not supported");yt[244]=ut,yt[245]=ut,yt[246]=ut,yt[247]=function(e,t,n,r){if(!1===r.allowUndefined)throw new Error(`${Ce} undefined values are not supported`);return!0===r.coerceUndefinedToNull?new ye(le.null,null,1):new ye(le.undefined,void 0,1)},yt[248]=lt("simple values are not supported"),yt[249]=function(e,t,n,r){return et(st(e,t+1),3,r)},yt[250]=function(e,t,n,r){return et(pt(e,t+1),5,r)},yt[251]=function(e,t,n,r){return et(dt(e,t+1),9,r)},yt[252]=ut,yt[253]=ut,yt[254]=ut,yt[255]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${Ce} indefinite length items not allowed`);return new ye(le.break,void 0,1)};const ct=[];for(let e=0;e<24;e++)ct[e]=new ye(le.uint,e,1);for(let e=-1;e>=-24;e--)ct[31-e]=new ye(le.negint,e,1);ct[64]=new ye(le.bytes,new Uint8Array(0),1),ct[96]=new ye(le.string,"",1),ct[128]=new ye(le.array,0,1),ct[160]=new ye(le.map,0,1),ct[244]=new ye(le.false,!1,1),ct[245]=new ye(le.true,!0,1),ct[246]=new ye(le.null,null,1),function(){const e=[];e[le.uint.major]=Ne,e[le.negint.major]=$e,e[le.bytes.major]=Ve,e[le.string.major]=He,e[le.array.major]=qe,e[le.map.major]=Ye,e[le.tag.major]=Je,e[le.float.major]=tt}(),new class{constructor(e=256){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Se(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=we(n,0,this.cursor)}else t=Te(this.chunks,this.cursor);return e&&this.reset(),t}};class mt{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Ae} object contains circular references`);return new mt(t,e)}}const ht={null:new ye(le.null,null),undefined:new ye(le.undefined,void 0),true:new ye(le.true,!0),false:new ye(le.false,!1),emptyArray:new ye(le.array,0),emptyMap:new ye(le.map,0)},ft={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new ye(e>=0?le.uint:le.negint,e):new ye(le.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new ye(le.uint,e):new ye(le.negint,e),Uint8Array:(e,t,n,r)=>new ye(le.bytes,e),string:(e,t,n,r)=>new ye(le.string,e),boolean:(e,t,n,r)=>e?ht.true:ht.false,null:(e,t,n,r)=>ht.null,undefined:(e,t,n,r)=>ht.undefined,ArrayBuffer:(e,t,n,r)=>new ye(le.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new ye(le.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[ht.emptyArray,new ye(le.break)]:ht.emptyArray;r=mt.createCheck(r,e);const i=[];let a=0;for(const t of e)i[a++]=gt(t,n,r);return n.addBreakTokens?[new ye(le.array,e.length),i,new ye(le.break)]:[new ye(le.array,e.length),i]},Object(e,t,n,r){const i="Object"!==t,a=i?e.keys():Object.keys(e),s=i?e.size:a.length;if(!s)return!0===n.addBreakTokens?[ht.emptyMap,new ye(le.break)]:ht.emptyMap;r=mt.createCheck(r,e);const o=[];let p=0;for(const t of a)o[p++]=[gt(t,n,r),gt(i?e.get(t):e[t],n,r)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(o,n),n.addBreakTokens?[new ye(le.map,s),o,new ye(le.break)]:[new ye(le.map,s),o]}};ft.Map=ft.Object,ft.Buffer=ft.Uint8Array;for(const e of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))ft[`${e}Array`]=ft.DataView;function gt(e,t={},n){const r=function(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(de.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";return function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(ue.includes(t))return t}(e)||"Object"}(e),i=t&&t.typeEncoders&&t.typeEncoders[r]||ft[r];if("function"==typeof i){const a=i(e,r,t,n);if(null!=a)return a}const a=ft[r];if(!a)throw new Error(`${Ae} unsupported type: ${r}`);return a(e,r,t,n)}Symbol.for("DONE"),Symbol.for("BREAK");const vt=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var a=e.charAt(i),s=a.charCodeAt(0);if(255!==n[s])throw new TypeError(a+" is ambiguous");n[s]=i}var o=e.length,p=e.charAt(0),d=Math.log(o)/Math.log(256),u=Math.log(256)/Math.log(o);function l(e){if("string"!=typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===p;)r++,t++;for(var a=(e.length-t)*d+1>>>0,s=new Uint8Array(a);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var l=0,y=a-1;(0!==u||l<i)&&-1!==y;y--,l++)u+=o*s[y]>>>0,s[y]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=l,t++}if(" "!==e[t]){for(var c=a-i;c!==a&&0===s[c];)c++;for(var m=new Uint8Array(r+(a-c)),h=r;c!==a;)m[h++]=s[c++];return m}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,a=t.length;i!==a&&0===t[i];)i++,n++;for(var s=(a-i)*u+1>>>0,d=new Uint8Array(s);i!==a;){for(var l=t[i],y=0,c=s-1;(0!==l||y<r)&&-1!==c;c--,y++)l+=256*d[c]>>>0,d[c]=l%o>>>0,l=l/o>>>0;if(0!==l)throw new Error("Non-zero carry");r=y,i++}for(var m=s-r;m!==s&&0===d[m];)m++;for(var h=p.repeat(n);m<s;++m)h+=e.charAt(d[m]);return h},decodeUnsafe:l,decode:function(e){var n=l(e);if(n)return n;throw new Error(`Non-${t} character`)}}};class wt{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Tt{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;const r=t.codePointAt(0);if(void 0===r)throw new Error("Invalid prefix character");this.prefixCodePoint=r,this.baseDecode=n}decode(e){if("string"==typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return Pt(this,e)}}class St{decoders;constructor(e){this.decoders=e}or(e){return Pt(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(null!=n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function Pt(e,t){return new St({...e.decoders??{[e.prefix]:e},...t.decoders??{[t.prefix]:t}})}class bt{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new wt(e,t,n),this.decoder=new Tt(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function It({name:e,prefix:t,encode:n,decode:r}){return new bt(e,t,n,r)}function Ct({name:e,prefix:t,alphabet:n}){const{encode:r,decode:i}=vt(n,e);return It({prefix:t,name:e,encode:r,decode:e=>z(i(e))})}function At({name:e,prefix:t,bitsPerChar:n,alphabet:r}){const i=function(e){const t={};for(let n=0;n<e.length;++n)t[e[n]]=n;return t}(r);return It({prefix:t,name:e,encode:e=>function(e,t,n){const r="="===t[t.length-1],i=(1<<n)-1;let a="",s=0,o=0;for(let r=0;r<e.length;++r)for(o=o<<8|e[r],s+=8;s>n;)s-=n,a+=t[i&o>>s];if(0!==s&&(a+=t[i&o<<n-s]),r)for(;a.length*n&7;)a+="=";return a}(e,r,n),decode:t=>function(e,t,n,r){let i=e.length;for(;"="===e[i-1];)--i;const a=new Uint8Array(i*n/8|0);let s=0,o=0,p=0;for(let d=0;d<i;++d){const i=t[e[d]];if(void 0===i)throw new SyntaxError(`Non-${r} character`);o=o<<n|i,s+=n,s>=8&&(s-=8,a[p++]=255&o>>s)}if(s>=n||255&o<<8-s)throw new SyntaxError("Unexpected end of data");return a}(t,i,n,e)})}const Dt=At({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_t=(At({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),At({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),At({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),At({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),At({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),At({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),At({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),At({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Ct({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"})),Et=(Ct({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Ct({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));Ct({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var xt=128,Rt=-128,Mt=Math.pow(2,31),kt=128,Nt=127,Ut=Math.pow(2,7),Ot=Math.pow(2,14),Ft=Math.pow(2,21),$t=Math.pow(2,28),Lt=Math.pow(2,35),Bt=Math.pow(2,42),zt=Math.pow(2,49),Vt=Math.pow(2,56),Wt=Math.pow(2,63);const jt={encode:function e(t,n,r){n=n||[];for(var i=r=r||0;t>=Mt;)n[r++]=255&t|xt,t/=128;for(;t&Rt;)n[r++]=255&t|xt,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},decode:function e(t,n){var r,i=0,a=(n=n||0,0),s=n,o=t.length;do{if(s>=o)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=a<28?(r&Nt)<<a:(r&Nt)*Math.pow(2,a),a+=7}while(r>=kt);return e.bytes=s-n,i},encodingLength:function(e){return e<Ut?1:e<Ot?2:e<Ft?3:e<$t?4:e<Lt?5:e<Bt?6:e<zt?7:e<Vt?8:e<Wt?9:10}};function Ht(e,t=0){return[jt.decode(e,t),jt.decode.bytes]}function Gt(e,t,n=0){return jt.encode(e,t,n),t}function Kt(e){return jt.encodingLength(e)}function qt(e,t){const n=t.byteLength,r=Kt(e),i=r+Kt(n),a=new Uint8Array(i+n);return Gt(e,a,0),Gt(n,a,r),a.set(t,i),new Zt(e,n,t,a)}class Zt{code;size;digest;bytes;constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}function Qt(e,t){const{bytes:n,version:r}=e;return 0===r?function(e,t,n){const{prefix:r}=n;if(r!==Et.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i}(n,Xt(e),t??Et.encoder):function(e,t,n){const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i}(n,Xt(e),t??Dt.encoder)}const Yt=new WeakMap;function Xt(e){const t=Yt.get(e);if(null==t){const t=new Map;return Yt.set(e,t),t}return t}class Jt{code;version;multihash;bytes;"/";constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==en)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==tn)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=qt(e,t);return Jt.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Jt.equals(this,e)}static equals(e,t){const n=t;return null!=n&&e.code===n.code&&e.version===n.version&&function(e,t){if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e.bytes,n.bytes)}}(e.multihash,n.multihash)}toString(e){return Qt(this,e)}toJSON(){return{"/":Qt(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Jt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new Jt(e,n,r,i??nn(e,n,r.bytes))}if(!0===t[rn]){const{version:e,multihash:n,code:r}=t,i=function(e){const t=z(e),[n,r]=Ht(t),[i,a]=Ht(t.subarray(r)),s=t.subarray(r+a);if(s.byteLength!==i)throw new Error("Incorrect length");return new Zt(n,i,s,t)}(n);return Jt.create(e,r,i)}return null}static create(e,t,n){if("number"!=typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==en)throw new Error(`Version 0 CID must use dag-pb (code: ${en}) block encoding`);return new Jt(e,t,n,n.bytes);case 1:{const r=nn(e,t,n.bytes);return new Jt(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Jt.create(0,en,e)}static createV1(e,t){return Jt.create(1,e,t)}static decode(e){const[t,n]=Jt.decodeFirst(e);if(0!==n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Jt.inspectBytes(e),n=t.size-t.multihashSize,r=z(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),a=new Zt(t.multihashCode,t.digestSize,i,r);return[0===t.version?Jt.createV0(a):Jt.createV1(t.codec,a),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=Ht(e.subarray(t));return t+=r,n};let r=n(),i=en;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const a=t,s=n(),o=n(),p=t+o;return{version:r,codec:i,multihashCode:s,digestSize:o,multihashSize:p-a,size:p}}static parse(e,t){const[n,r]=function(e,t){switch(e[0]){case"Q":{const n=t??Et;return[Et.prefix,n.decode(`${Et.prefix}${e}`)]}case Et.prefix:{const n=t??Et;return[Et.prefix,n.decode(e)]}case Dt.prefix:{const n=t??Dt;return[Dt.prefix,n.decode(e)]}case _t.prefix:{const n=t??_t;return[_t.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),i=Jt.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Xt(i).set(n,e),i}}const en=112,tn=18;function nn(e,t,n){const r=Kt(e),i=r+Kt(t),a=new Uint8Array(i+n.byteLength);return Gt(e,a,0),Gt(t,a,r),a.set(n,i),a}const rn=Symbol.for("@ipld/js-cid/CID"),an={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};function sn(e,t){return Jt.create(1,e,t)}an.tags[42]=function(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Jt.decode(e.subarray(1))},an.tags.slice();const on=(e,t,n)=>{const r=new Uint8Array(e.length+t.length);return r.set(e,0),r.set(t,e.length),function(e,t={}){const n=t.hasher||a,{digest:r}=n.digest(e);return(i=r)[31]&=63,i;var i}(r,n)},pn=new class{constructor(){this.bytes=new Uint8Array(2048),this.bytes.set($(),0),this.node=$(),this.length=O}slice(e,t){for(;this.length<t;)this.node=on(this.node,this.node),this.bytes.set(this.node,this.length),this.length+=O;return this.bytes.subarray(e,t)}},dn=e=>{if(e<0||e>=64)throw new Error("Only levels between 0 and 63 inclusive are available");return pn.slice(O*e,O*(e+1))},un=e=>{const t=e.length/O,n=new Array(t);for(let r=0;r<t;r++){const t=r*O,i=e.subarray(t,t+O);n[r]=i}return n};function ln(e){const t=Math.max(e,65),n=Math.floor(Math.log2(t)),r=Math.ceil(U*2**(n+1));return t<=r?r:Math.ceil(U*2**(n+2))}const yn=(e,t=new Uint8Array((e=>ln(e)/U)(e.length)))=>{const n=ln(e.byteLength)/k;for(let r=0;r<n;r++){const n=r*k,i=128*r;t.set(e.subarray(n,n+32),i),t[i+31]&=63;for(let r=32;r<64;r++)t[i+r]=e[n+r]<<2|e[n+r-1]>>6;t[i+63]&=63;for(let r=64;r<96;r++)t[i+r]=e[n+r]<<4|e[n+r-1]>>4;t[i+95]&=63;for(let r=96;r<127;r++)t[i+r]=e[n+r]<<6|e[n+r-1]>>2;t[i+127]=e[n+126]>>2}return t},cn=e=>{return 2n**BigInt((t=(e+N-1n)/N)<=1n?0:(e=>{let t=0n;for(;e>>=1n;)t++;return Number(t)})(BigInt(t)-1n)+1);var t},mn=e=>hn(2n**BigInt(e)),hn=e=>e*F,fn=4113,gn=ie,vn=10+ie,wn=Kt(fn),Tn=wn+Kt(vn)+vn;mn(255),BigInt(254),BigInt(256);class Sn{constructor(e){this.bytes=e;const[t]=Ht(e);if(t!==fn)throw new RangeError("Expected multihash with code 4113");let n=wn;const[r,i]=Ht(e,n);n+=i;const a=e.subarray(n);if(a.length!==r)throw new RangeError(`Invalid multihash size expected ${n+r} bytes, got ${e.length} bytes`);this.digest=a}get name(){return"fr32-sha2-256-trunc254-padded-binary-tree"}get code(){return fn}get size(){return this.digest.length}get padding(){return(({digest:e})=>{const[t]=Ht(e);return BigInt(t)})(this)}get height(){return(({digest:e})=>{const[,t]=Ht(e);return e[t]})(this)}get root(){return(({digest:e})=>{const[,t]=Ht(e);return e.subarray(t+1,t+1+ie)})(this)}}const Pn=4113,bn=mn(255)*BigInt(254)/BigInt(256),In=()=>new Cn;class Cn{constructor(){this.bytesWritten=0n,this.buffer=new Uint8Array(k),this.offset=0,this.layers=[[]]}count(){return this.bytesWritten}digest(){const e=new Uint8Array(Tn),t=this.digestInto(e,0,!0);return(e=>new Sn(e))(e.subarray(0,t))}digestInto(e,t=0,n=!0){const{buffer:r,layers:i,offset:a,bytesWritten:s}=this;let[o,...p]=i;(a>0||0n===s)&&(o=[...o,...un(yn(r.fill(0,a)))]);const d=Dn([o,...p]),u=d.length-1,[l]=d[u],y=Number((e=>(e=>cn(e)*N)(e)-e)(this.bytesWritten)),c=Kt(y);let m=t;if(n){Gt(Pn,e,m),m+=wn;const t=c+1+gn,n=Kt(t);Gt(t,e,m),m+=n}return Gt(y,e,m),m+=c,e[m]=u,m+=1,e.set(l,m),m+=l.length,m-t}write(e){const{buffer:t,offset:n,layers:r}=this,i=r[0],{length:a}=e;if(0===a)return this;if(this.bytesWritten+BigInt(a)>bn)throw new RangeError(`Writing ${a} bytes exceeds max payload size of ${bn}`);if(n+a<t.length)return t.set(e,n),this.offset+=a,this.bytesWritten+=BigInt(a),this;{const r=t.length-n;t.set(e.subarray(0,r),n),i.push(...un(yn(t)));let s=r;for(;s+k<a;){const t=e.subarray(s,s+k);i.push(...un(yn(t))),s+=k}return this.buffer.set(e.subarray(s),0),this.offset=a-s,this.bytesWritten+=BigInt(a),An(this.layers),this}}reset(){return this.offset=0,this.bytesWritten=0n,this.layers.length=1,this.layers[0].length=0,this}dispose(){this.reset()}get code(){return Pn}get name(){return"fr32-sha2-256-trunc254-padded-binary-tree"}}const An=e=>_n(e,!1),Dn=e=>_n([...e],!0),_n=(e,t)=>{let n=0;for(;n<e.length;){let r=e[n+1];const i=e[n];t&&i.length%2>0&&r&&i.push(dn(n)),n+=1,r=r?t?[...r]:r:[];let a=0;for(;a+1<i.length;){const e=on(i[a],i[a+1]);delete i[a],delete i[a+1],r.push(e),a+=2}r.length&&(e[n]=r),i.splice(0,a)}return e},En=85,xn=61697,Rn=4114;function Mn(e){return e.code===En&&e.multihash.code===Pn}function kn(e){return e.code===xn&&e.multihash.code===Rn}function Nn(e){return"string"==typeof e?function(e){try{const t=Jt.parse(e);if(Mn(t))return t}catch{}return null}(e):"object"==typeof e&&null!==Jt.asCID(e)&&Mn(e)?e:null}function Un(e){const t=Nn(e);if(null!=t){const e=qt(Rn,t.multihash.digest.subarray(-32));return sn(xn,e)}return"string"==typeof e?function(e){try{const t=Jt.parse(e);if(kn(t))return t}catch{}return null}(e):"object"==typeof e&&null!==Jt.asCID(e)&&kn(e)?e:null}function On(e){const t=In();for(let n=0;n<e.length;n+=2048)t.write(e.subarray(n,n+2048));const n=t.digest();return sn(En,n)}function Fn(){const e=In();let t=!1,n=null;const r=new TransformStream({transform(t,n){e.write(t),n.enqueue(t)},flush(){const r=e.digest();n=sn(En,r),t=!0}});return{stream:r,getPieceCID:()=>t?n:null}}const $n={MetadataEntry:[{name:"key",type:"string"},{name:"value",type:"string"}],CreateDataSet:[{name:"clientDataSetId",type:"uint256"},{name:"payee",type:"address"},{name:"metadata",type:"MetadataEntry[]"}],Cid:[{name:"data",type:"bytes"}],PieceMetadata:[{name:"pieceIndex",type:"uint256"},{name:"metadata",type:"MetadataEntry[]"}],AddPieces:[{name:"clientDataSetId",type:"uint256"},{name:"firstAdded",type:"uint256"},{name:"pieceData",type:"Cid[]"},{name:"pieceMetadata",type:"PieceMetadata[]"}],SchedulePieceRemovals:[{name:"clientDataSetId",type:"uint256"},{name:"pieceIds",type:"uint256[]"}],DeleteDataSet:[{name:"clientDataSetId",type:"uint256"}]};class Ln{signer;domain;WITH_CDN_METADATA={key:"withCDN",value:""};constructor(e,t,n){this.signer=t,this.domain={name:"FilecoinWarmStorageService",version:"1",chainId:Number(n),verifyingContract:e}}getUnderlyingSigner(){return"signer"in this.signer&&"NonceManager"===this.signer.constructor.name?this.signer.signer:this.signer}async isMetaMaskSigner(){try{const e=this.getUnderlyingSigner();if("Wallet"===e.constructor.name)return!1;const t=e.provider;if(null==t)return!1;if("_eip1193Provider"in t)return!0;if("undefined"!=typeof globalThis&&"window"in globalThis){const e=globalThis;if(null!=e.window?.ethereum)return!0}if("send"in t||"request"in t)return!0}catch{}return!1}async signWithMetaMask(e,t){const n=this.signer.provider;if(null==n)throw new Error("No provider available");const r=await this.signer.getAddress();let i="";for(const t of Object.keys(e))if("Cid"!==t&&"PieceData"!==t){i=t;break}const a={types:{EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],...e},primaryType:i,domain:this.domain,message:t};let s,o;return s="_eip1193Provider"in n?n._eip1193Provider:n,o=null!=s&&"request"in s?await s.request({method:"eth_signTypedData_v4",params:[r.toLowerCase(),JSON.stringify(a)]}):await n.send("eth_signTypedData_v4",[r.toLowerCase(),JSON.stringify(a)]),o}async signCreateDataSet(e,t,n=[]){let r;const i={CreateDataSet:$n.CreateDataSet,MetadataEntry:$n.MetadataEntry};if(await this.isMetaMaskSigner()){const a={clientDataSetId:e.toString(),metadata:n,payee:t};r=await this.signWithMetaMask(i,a)}else{const a={clientDataSetId:BigInt(e),metadata:n,payee:t},s=this.getUnderlyingSigner();r=await s.signTypedData(this.domain,i,a)}const a=u.ethers.Signature.from(r),s=u.ethers.TypedDataEncoder.hash(this.domain,i,{clientDataSetId:BigInt(e),metadata:n,payee:t});return{signature:r,v:a.v,r:a.r,s:a.s,signedData:s}}async signAddPieces(e,t,n,r=[]){if(0===r.length)r=Array(n.length).fill([]);else if(r.length!==n.length)throw new Error("metadata length must match pieceDataArray length");const i=[],a=[];for(let e=0;e<n.length;e++){const t=n[e],s="string"==typeof t?Nn(t):t;if(null==s)throw new Error(`Invalid PieceCID: ${String(s)}`);a.push({data:s.bytes}),i.push({pieceIndex:e,metadata:r[e]})}const s={AddPieces:$n.AddPieces,Cid:$n.Cid,PieceMetadata:$n.PieceMetadata,MetadataEntry:$n.MetadataEntry};let o;if(await this.isMetaMaskSigner()){const n={clientDataSetId:e.toString(),firstAdded:t.toString(),pieceData:a.map(e=>({data:u.ethers.hexlify(e.data)})),pieceMetadata:i};o=await this.signWithMetaMask(s,n)}else{const n={clientDataSetId:BigInt(e),firstAdded:BigInt(t),pieceData:a,pieceMetadata:i},r=this.getUnderlyingSigner();o=await r.signTypedData(this.domain,s,n)}const p=u.ethers.Signature.from(o),d=u.ethers.TypedDataEncoder.hash(this.domain,s,{clientDataSetId:BigInt(e),firstAdded:BigInt(t),pieceData:a,pieceMetadata:i});return{signature:o,v:p.v,r:p.r,s:p.s,signedData:d}}async signSchedulePieceRemovals(e,t){const n=t.map(e=>BigInt(e));let r;if(await this.isMetaMaskSigner()){const t={clientDataSetId:e.toString(),pieceIds:n.map(e=>e.toString())};r=await this.signWithMetaMask({SchedulePieceRemovals:$n.SchedulePieceRemovals},t)}else{const t={clientDataSetId:BigInt(e),pieceIds:n},i=this.getUnderlyingSigner();r=await i.signTypedData(this.domain,{SchedulePieceRemovals:$n.SchedulePieceRemovals},t)}const i=u.ethers.Signature.from(r),a=u.ethers.TypedDataEncoder.hash(this.domain,{SchedulePieceRemovals:$n.SchedulePieceRemovals},{clientDataSetId:BigInt(e),pieceIds:n});return{signature:r,v:i.v,r:i.r,s:i.s,signedData:a}}async signDeleteDataSet(e){let t;if(await this.isMetaMaskSigner()){const n={clientDataSetId:e.toString()};t=await this.signWithMetaMask({DeleteDataSet:$n.DeleteDataSet},n)}else{const n={clientDataSetId:BigInt(e)},r=this.getUnderlyingSigner();t=await r.signTypedData(this.domain,{DeleteDataSet:$n.DeleteDataSet},n)}const n=u.ethers.Signature.from(t),r=u.ethers.TypedDataEncoder.hash(this.domain,{DeleteDataSet:$n.DeleteDataSet},{clientDataSetId:BigInt(e)});return{signature:t,v:n.v,r:n.r,s:n.s,signedData:r}}async getSignerAddress(){return await this.signer.getAddress()}}function Bn(e){if("object"!=typeof e||null==e)return!1;const t=e;return!("string"!=typeof t.createMessageHash||"boolean"!=typeof t.dataSetCreated||"string"!=typeof t.service||"string"!=typeof t.txStatus||null!==t.ok&&"boolean"!=typeof t.ok||void 0!==t.dataSetId&&"number"!=typeof t.dataSetId)}function zn(e){if("object"!=typeof e||null==e)return!1;const t=e;if("string"!=typeof t.txHash)return!1;if("string"!=typeof t.txStatus)return!1;if("number"!=typeof t.dataSetId)return!1;if("number"!=typeof t.pieceCount)return!1;if(null!==t.addMessageOk&&"boolean"!=typeof t.addMessageOk)return!1;if(void 0!==t.confirmedPieceIds){if(!Array.isArray(t.confirmedPieceIds))return!1;for(const e of t.confirmedPieceIds)if("number"!=typeof e)return!1}return!0}function Vn(e){if("object"!=typeof e||null==e)return!1;const t=e;return"string"==typeof t.pieceCid&&null!=Nn(t.pieceCid)}function Wn(e){if(!Bn(e))throw new Error("Invalid data set creation status response format");return e}function jn(e){if(!zn(e))throw new Error("Invalid piece addition status response format");return e}function Hn(e){if(!Vn(e)){if("object"==typeof e&&null!=e){const t=e,n=t.pieceCid??t.piece_cid;if(null!=n&&null==Nn(n))throw new Error("Invalid find piece response: pieceCid is not a valid PieceCID")}throw new Error("Invalid find piece response format")}const t=e,n=Nn(t.pieceCid??t.piece_cid);if(null==n)throw new Error("Invalid find piece response: pieceCid is not a valid PieceCID");return{pieceCid:n,piece_cid:t.piece_cid}}function Gn(e){if("object"!=typeof e||null==e)return null;const t=e;if("number"!=typeof t.pieceId)return null;if("string"!=typeof t.pieceCid)return null;if("string"!=typeof t.subPieceCid)return null;if("number"!=typeof t.subPieceOffset)return null;const n=Nn(t.pieceCid),r=Nn(t.subPieceCid);return null==n||null==r?null:{pieceId:t.pieceId,pieceCid:n,subPieceCid:r,subPieceOffset:t.subPieceOffset}}function Kn(e){if("object"!=typeof e||null==e)return null;const t=e;if("number"!=typeof t.id)return null;if(!Array.isArray(t.pieces))return null;const n=[];for(const e of t.pieces){const t=Gn(e);if(null==t)return null;n.push(t)}return"number"!=typeof t.nextChallengeEpoch?null:{id:t.id,pieces:n,nextChallengeEpoch:t.nextChallengeEpoch}}class qn{_serviceURL;_authHelper;constructor(e,t){if(""===t.trim())throw new Error("PDP service URL is required");this._serviceURL=t.replace(/\/$/,""),this._authHelper=e}async createDataSet(e,t,n,r){const i=n?[this.getAuthHelper().WITH_CDN_METADATA]:[],a=await this.getAuthHelper().signCreateDataSet(e,t,i),s={recordKeeper:r,extraData:`0x${this._encodeDataSetCreateData({payer:await this.getAuthHelper().getSignerAddress(),metadata:i,signature:a.signature})}`},o=await fetch(`${this._serviceURL}/pdp/data-sets`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(201!==o.status){const e=await o.text();throw new Error(`Failed to create data set: ${o.status} ${o.statusText} - ${e}`)}const p=o.headers.get("Location");if(null==p)throw new Error("Server did not provide Location header in response");const d=p.match(/\/pdp\/data-sets\/created\/(.+)$/);if(null==d)throw new Error(`Invalid Location header format: ${p}`);return{txHash:d[1],statusUrl:`${this._serviceURL}${p}`}}async addPieces(e,t,n,r){if(0===r.length)throw new Error("At least one piece must be provided");const i=[];for(const e of r){if(null==Nn(e))throw new Error(`Invalid PieceCID: ${String(e)}`);i.push([])}const a=await this.getAuthHelper().signAddPieces(t,n,r,i),s=this._encodeAddPiecesExtraData({signature:a.signature,metadata:i}),o={pieces:r.map(e=>{const t="string"==typeof e?e:e.toString();return{pieceCid:t,subPieces:[{subPieceCid:t}]}}),extraData:`0x${s}`},p=await fetch(`${this._serviceURL}/pdp/data-sets/${e}/pieces`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(201!==p.status){const e=await p.text();throw new Error(`Failed to add pieces to data set: ${p.status} ${p.statusText} - ${e}`)}const d=p.headers.get("Location");let u,l;if(null!=d){const e=d.match(/\/pieces\/added\/([0-9a-fA-Fx]+)$/);null!=e&&(u=e[1],u.startsWith("0x")||(u=`0x${u}`),l=`${this._serviceURL}${d}`)}const y=await p.text();return{message:""!==y?y:`Pieces added to data set ID ${e} successfully`,txHash:u,statusUrl:l}}async getDataSetCreationStatus(e){const t=await fetch(`${this._serviceURL}/pdp/data-sets/created/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===t.status)throw new Error(`Data set creation not found for transaction hash: ${e}`);if(200!==t.status){const e=await t.text();throw new Error(`Failed to get data set creation status: ${t.status} ${t.statusText} - ${e}`)}return Wn(await t.json())}async getPieceAdditionStatus(e,t){const n=await fetch(`${this._serviceURL}/pdp/data-sets/${e}/pieces/added/${t}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(404===n.status)throw new Error(`Piece addition not found for transaction: ${t}`);if(200!==n.status){const e=await n.text();throw new Error(`Failed to get piece addition status: ${n.status} ${n.statusText} - ${e}`)}return jn(await n.json())}async findPiece(e){const t=Nn(e);if(null==t)throw new Error(`Invalid PieceCID: ${String(e)}`);const n=E(this._serviceURL,t),r=await fetch(n,{method:"GET",headers:{}});if(404===r.status)throw new Error(`Piece not found: ${t.toString()}`);if(!r.ok){const e=await r.text();throw new Error(`Failed to find piece: ${r.status} ${r.statusText} - ${e}`)}return Hn(await r.json())}async uploadPiece(e){const t=e instanceof ArrayBuffer?new Uint8Array(e):e;performance.mark("synapse:calculatePieceCID-start");const n=On(t);performance.mark("synapse:calculatePieceCID-end"),performance.measure("synapse:calculatePieceCID","synapse:calculatePieceCID-start","synapse:calculatePieceCID-end");const r=t.length,i={pieceCid:n.toString()};performance.mark("synapse:POST.pdp.piece-start");const a=await fetch(`${this._serviceURL}/pdp/piece`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(performance.mark("synapse:POST.pdp.piece-end"),performance.measure("synapse:POST.pdp.piece","synapse:POST.pdp.piece-start","synapse:POST.pdp.piece-end"),200===a.status)return{pieceCid:n,size:r};if(201!==a.status){const e=await a.text();throw new Error(`Failed to create upload session: ${a.status} ${a.statusText} - ${e}`)}const s=a.headers.get("Location");if(null==s)throw new Error("Server did not provide Location header in response (may be restricted by CORS policy)");const o=s.match(/\/(?:pdp\/)?piece\/upload\/([a-fA-F0-9-]+)/);if(null==o)throw new Error(`Invalid Location header format: ${s}`);const p=o[1];performance.mark("synapse:PUT.pdp.piece.upload-start");const d=await fetch(`${this._serviceURL}/pdp/piece/upload/${p}`,{method:"PUT",headers:{"Content-Type":"application/octet-stream","Content-Length":t.length.toString()},body:t});if(performance.mark("synapse:PUT.pdp.piece.upload-end"),performance.measure("synapse:PUT.pdp.piece.upload","synapse:PUT.pdp.piece.upload-start","synapse:PUT.pdp.piece.upload-end"),204!==d.status){const e=await d.text();throw new Error(`Failed to upload piece: ${d.status} ${d.statusText} - ${e}`)}return{pieceCid:n,size:r}}async downloadPiece(e){const t=Nn(e);if(null==t)throw new Error(`Invalid PieceCID: ${String(e)}`);const n=_(this._serviceURL,t),r=await fetch(n);return await R(r,t)}async getDataSet(e){const t=await fetch(`${this._serviceURL}/pdp/data-sets/${e}`,{method:"GET",headers:{Accept:"application/json"}});if(404===t.status)throw new Error(`Data set not found: ${e}`);if(!t.ok){const e=await t.text();throw new Error(`Failed to fetch data set: ${t.status} ${t.statusText} - ${e}`)}const n=await t.json(),r=Kn(n);if(null==r)throw console.error("Invalid data set data response:",n),new Error("Invalid data set data response format");return r}_encodeDataSetCreateData(e){const t=e.signature.startsWith("0x")?e.signature:`0x${e.signature}`,n=e.metadata.map(e=>e.key),r=e.metadata.map(e=>e.value);return u.ethers.AbiCoder.defaultAbiCoder().encode(["address","string[]","string[]","bytes"],[e.payer,n,r,t]).slice(2)}_encodeAddPiecesExtraData(e){const t=e.signature.startsWith("0x")?e.signature:`0x${e.signature}`,n=e.metadata.map(e=>e.map(e=>e.key)),r=e.metadata.map(e=>e.map(e=>e.value));return u.ethers.AbiCoder.defaultAbiCoder().encode(["bytes","string[][]","string[][]"],[t,n,r]).slice(2)}async ping(){const e=await fetch(`${this._serviceURL}/pdp/ping`,{method:"GET",headers:{}});if(200!==e.status){const t=await e.text().catch(()=>"Unknown error");throw new Error(`Provider ping failed: ${e.status} ${e.statusText} - ${t}`)}}getServiceURL(){return this._serviceURL}getAuthHelper(){if(null==this._authHelper)throw new Error("AuthHelper is not available for an operation that requires signing");return this._authHelper}}class Zn{_provider;_contractAddress;_contract;constructor(e,t){this._provider=e,this._contractAddress=t,this._contract=new u.ethers.Contract(this._contractAddress,c.PDP_VERIFIER,this._provider)}async dataSetLive(e){return await this._contract.dataSetLive(e)}async getNextPieceId(e){const t=await this._contract.getNextPieceId(e);return Number(t)}async getDataSetListener(e){return await this._contract.getDataSetListener(e)}async getDataSetStorageProvider(e){const[t,n]=await this._contract.getDataSetStorageProvider(e);return{storageProvider:t,proposedStorageProvider:n}}async getDataSetLeafCount(e){const t=await this._contract.getDataSetLeafCount(e);return Number(t)}extractDataSetIdFromReceipt(e){try{for(const t of e.logs)try{const e=this._contract.interface.parseLog({topics:t.topics,data:t.data});if(null!=e&&"DataSetCreated"===e.name)return Number(e.args.setId)}catch{}return null}catch(e){throw new Error(`Failed to extract data set ID from receipt: ${e instanceof Error?e.message:String(e)}`)}}getContractAddress(){return this._contract.target}}class Qn{_provider;_registryAddress;_registryContract=null;constructor(e,t){this._provider=e,this._registryAddress=t}static async create(e,t){return new Qn(e,t)}_getRegistryContract(){return null==this._registryContract&&(this._registryContract=new u.ethers.Contract(this._registryAddress,c.SERVICE_PROVIDER_REGISTRY,this._provider)),this._registryContract}async registerProvider(e,t){const n=this._getRegistryContract().connect(e),r=await n.REGISTRATION_FEE();let i=0,a="0x",s=[],o=[];if(null!=t.pdpOffering&&(i=0,a=await this.encodePDPOffering(t.pdpOffering),null!=t.capabilities)){s=[],o=[];for(const[e,n]of Object.entries(t.capabilities))s.push(e),o.push(n??"")}return await n.registerProvider(t.payee,t.name,t.description,i,a,s,o,{value:r})}async updateProviderInfo(e,t,n){const r=this._getRegistryContract().connect(e);return await r.updateProviderInfo(t,n)}async removeProvider(e){const t=this._getRegistryContract().connect(e);return await t.removeProvider()}async getProvider(e){try{const t=this._getRegistryContract(),n=await t.getProvider(e);if(n.serviceProvider===u.ethers.ZeroAddress)return null;const r=await this._getProviderProducts(e);return this._convertToProviderInfo(e,n,r)}catch(e){if(e instanceof Error&&e.message.includes("Provider not found"))return null;throw e}}async getProviderByAddress(e){try{const t=this._getRegistryContract(),[n,r]=await Promise.all([t.getProviderByAddress(e),t.getProviderIdByAddress(e)]);if(n.serviceProvider===u.ethers.ZeroAddress)return null;const i=await this._getProviderProducts(Number(r));return this._convertToProviderInfo(Number(r),n,i)}catch{return null}}async getProviderIdByAddress(e){const t=this._getRegistryContract(),n=await t.getProviderIdByAddress(e);return Number(n)}async getAllActiveProviders(){const e=this._getRegistryContract(),t=[];let n=0,r=!0;for(;r;){const i=await e.getAllActiveProviders(n,50),a=i[0];if(r=i[1],a.length>0){const e=a.map(e=>Number(e));t.push(this.getProviders(e))}n+=50}return(await Promise.all(t)).flat()}async getActiveProvidersByProductType(e){const t=this._getRegistryContract(),n=[];let r=0,i=!0;for(;i;){const a=await t.getProvidersByProductType(e,r,50);if(a.providerIds.length>0){const e=a.providerIds.map(e=>Number(e));n.push(this.getProviders(e))}i=a.hasMore,r+=50}return(await Promise.all(n)).flat().filter(e=>e.active)}async isProviderActive(e){const t=this._getRegistryContract();return await t.isProviderActive(e)}async isRegisteredProvider(e){const t=this._getRegistryContract();return await t.isRegisteredProvider(e)}async getProviderCount(){const e=this._getRegistryContract(),t=await e.getProviderCount();return Number(t)}async activeProviderCount(){const e=this._getRegistryContract(),t=await e.activeProviderCount();return Number(t)}async addPDPProduct(e,t,n={}){const r=this._getRegistryContract().connect(e),i=await this.encodePDPOffering(t),a=Object.entries(n),s=a.map(([e])=>e),o=a.map(([,e])=>e||"");return await r.addProduct(0,i,s,o)}async updatePDPProduct(e,t,n={}){const r=this._getRegistryContract().connect(e),i=await this.encodePDPOffering(t),a=Object.entries(n),s=a.map(([e])=>e),o=a.map(([,e])=>e||"");return await r.updateProduct(0,i,s,o)}async removeProduct(e,t){const n=this._getRegistryContract().connect(e);return await n.removeProduct(t)}async getPDPService(e){try{const t=this._getRegistryContract(),n=await t.getPDPService(e);return n.pdpOffering.serviceURL?{offering:{serviceURL:n.pdpOffering.serviceURL,minPieceSizeInBytes:n.pdpOffering.minPieceSizeInBytes,maxPieceSizeInBytes:n.pdpOffering.maxPieceSizeInBytes,ipniPiece:n.pdpOffering.ipniPiece,ipniIpfs:n.pdpOffering.ipniIpfs,storagePricePerTibPerMonth:n.pdpOffering.storagePricePerTibPerMonth,minProvingPeriodInEpochs:Number(n.pdpOffering.minProvingPeriodInEpochs),location:n.pdpOffering.location,paymentTokenAddress:n.pdpOffering.paymentTokenAddress},capabilities:this._convertCapabilitiesToObject(n.capabilityKeys,n.capabilityValues||[]),isActive:n.isActive}:null}catch{return null}}async providerHasProduct(e,t){const n=this._getRegistryContract();return await n.providerHasProduct(e,t)}async getProviders(e){if(0===e.length)return[];try{return await this._getProvidersWithMulticall(e)}catch{return await this._getProvidersIndividually(e)}}async _getProvidersWithMulticall(e){const t=await D(this._provider),n=w.MULTICALL3[t],r=new u.ethers.Contract(n,c.MULTICALL3,this._provider),i=new u.ethers.Interface(c.SERVICE_PROVIDER_REGISTRY),a=this._prepareMulticallCalls(e,i),s=await r.aggregate3.staticCall(a);return this._processMulticallResults(e,s,i)}_prepareMulticallCalls(e,t){const n=[];for(const r of e)n.push({target:this._registryAddress,allowFailure:!0,callData:t.encodeFunctionData("getProvider",[r])}),n.push({target:this._registryAddress,allowFailure:!0,callData:t.encodeFunctionData("getPDPService",[r])});return n}_processMulticallResults(e,t,n){const r=[];for(let i=0;i<e.length;i++){const a=2*i,s=2*i+1;if(t[a].success)try{const o=n.decodeFunctionResult("getProvider",t[a].returnData)[0],p=this._extractProductsFromMulticallResult(t[s],n),d=this._convertToProviderInfo(e[i],o,p);r.push(d)}catch{}}return r}_extractProductsFromMulticallResult(e,t){const n=[];if(!e.success)return n;try{const r=t.decodeFunctionResult("getPDPService",e.returnData),[i,a,s]=r;if(!i[0])return n;const o=this._buildCapabilitiesFromKeys(a);n.push({type:"PDP",isActive:s,capabilities:o,data:{serviceURL:i[0],minPieceSizeInBytes:i[1],maxPieceSizeInBytes:i[2],ipniPiece:i[3],ipniIpfs:i[4],storagePricePerTibPerMonth:i[5],minProvingPeriodInEpochs:Number(i[6]),location:i[7],paymentTokenAddress:i[8]}})}catch{}return n}_buildCapabilitiesFromKeys(e){const t={};if(e&&Array.isArray(e))for(const n of e)t[n]="";return t}async _getProvidersIndividually(e){const t=[],n=e.map(e=>this.getProvider(e)),r=await Promise.all(n);for(const e of r)null!=e&&t.push(e);return t}async _getProviderProducts(e){const t=[],n=await this.getPDPService(e);return null!=n&&t.push({type:"PDP",isActive:n.isActive,capabilities:n.capabilities,data:n.offering}),t}_convertToProviderInfo(e,t,n){const r={};for(const e of n)"PDP"===e.type&&(r.PDP=e);return{id:e,serviceProvider:t.serviceProvider,payee:t.payee,name:t.name,description:t.description,active:t.isActive,products:r}}_convertCapabilitiesToObject(e,t){const n={};for(let r=0;r<e.length;r++)n[e[r]]=t[r]||"";return n}async encodePDPOffering(e){const t=this._getRegistryContract();return await t.encodePDPOffering(e)}}class Yn{warmStorage;spRegistry;constructor(e,t){this.warmStorage=e,this.spRegistry=t}async getApprovedProviders(e=50){const t=await this.warmStorage.getApprovedProviderIds();if(t.length<=e)return await this.spRegistry.getProviders(t);const n=[];let r=0;for(;r<t.length;){const i=t.slice(r,r+e),a=await this.spRegistry.getProviders(i);n.push(...a),r+=e}return n}async getApprovedProvider(e){return await this.warmStorage.isProviderIdApproved(e)?await this.spRegistry.getProvider(e):null}async getApprovedProvidersByIds(e){if(0===e.length)return[];try{const t=this.warmStorage.getProvider(),n=await D(t),r=w.MULTICALL3[n],i=new u.ethers.Contract(r,c.MULTICALL3,t),a=this.warmStorage.getViewContractAddress(),s=new u.ethers.Interface(c.WARM_STORAGE_VIEW),o=e.map(e=>({target:a,allowFailure:!0,callData:s.encodeFunctionData("isProviderApproved",[e])})),p=(await i.aggregate3.staticCall(o)).map(e=>{if(!e.success)return!1;try{return s.decodeFunctionResult("isProviderApproved",e.returnData)[0]}catch{return!1}}),d=e.filter((e,t)=>p[t]);if(0===d.length)return e.map(()=>null);const l=await this.spRegistry.getProviders(d),y=new Map;for(const e of l)y.set(e.id,e);return e.map((e,t)=>p[t]?y.get(e)??null:null)}catch{const t=await Promise.all(e.map(e=>this.warmStorage.isProviderIdApproved(e))),n=e.filter((e,n)=>t[n]);if(0===n.length)return e.map(()=>null);const r=await this.spRegistry.getProviders(n),i=new Map;for(const e of r)i.set(e.id,e);return e.map((e,n)=>t[n]?i.get(e)??null:null)}}async getApprovedProviderByAddress(e){const t=await this.spRegistry.getProviderByAddress(e);return null==t?null:await this.warmStorage.isProviderIdApproved(t.id)?t:null}async isProviderApproved(e){return!!await this.warmStorage.isProviderIdApproved(e)&&await this.spRegistry.isProviderActive(e)}}class Xn{_synapse;_provider;_pdpServer;_warmStorageService;_warmStorageAddress;_withCDN;_dataSetId;_signer;_uploadBatchSize;_pendingPieces=[];_isProcessing=!1;dataSetId;serviceProvider;get withCDN(){return this._withCDN}get provider(){return this._provider}static validateRawSize(e,t){if(e<f.MIN_UPLOAD_SIZE)throw T("StorageContext",t,`Data size ${e} bytes is below minimum allowed size of ${f.MIN_UPLOAD_SIZE} bytes`);if(e>f.MAX_UPLOAD_SIZE)throw T("StorageContext",t,`Data size ${e} bytes exceeds maximum allowed size of ${f.MAX_UPLOAD_SIZE} bytes (${Math.floor(f.MAX_UPLOAD_SIZE/1024/1024)} MiB)`)}constructor(e,t,n,r,i){this._synapse=e,this._provider=n,this._dataSetId=r,this._withCDN=i.withCDN??!1,this._signer=e.getSigner(),this._warmStorageService=t,this._uploadBatchSize=Math.max(1,i.uploadBatchSize??f.DEFAULT_UPLOAD_BATCH_SIZE),this.dataSetId=r,this.serviceProvider=n.serviceProvider,this._warmStorageAddress=e.getWarmStorageAddress();const a=new Ln(this._warmStorageAddress,this._signer,BigInt(e.getChainId()));if(!n.products.PDP?.data.serviceURL)throw new Error(`Provider ${n.id} does not have a PDP product with serviceURL`);this._pdpServer=new qn(a,n.products.PDP.data.serviceURL)}static async create(e,t,n={}){const r=t.getServiceProviderRegistryAddress(),i=new Qn(e.getProvider(),r),a=new Yn(t,i),s=await Xn.resolveProviderAndDataSet(e,t,a,n);try{n.callbacks?.onProviderSelected?.(s.provider)}catch(e){console.error("Error in onProviderSelected callback:",e)}let o;if(-1===s.dataSetId||!0===n.forceCreateDataSet)o=await Xn.createDataSet(e,t,s.provider,n.withCDN??!1,n.callbacks);else{o=s.dataSetId;try{n.callbacks?.onDataSetResolved?.({isExisting:s.isExisting??!0,dataSetId:o,provider:s.provider})}catch(e){console.error("Error in onDataSetResolved callback:",e)}}return new Xn(e,t,s.provider,o,n)}static async createDataSet(e,t,n,r,i){performance.mark("synapse:createDataSet-start");const a=e.getSigner(),s=await a.getAddress(),o=await t.getNextClientDataSetId(s),p=e.getWarmStorageAddress(),d=new Ln(p,a,BigInt(e.getChainId()));if(!n.products.PDP?.data.serviceURL)throw new Error(`Provider ${n.id} does not have a PDP product with serviceURL`);const u=new qn(d,n.products.PDP.data.serviceURL);performance.mark("synapse:pdpServer.createDataSet-start");const l=await u.createDataSet(o,n.payee,r,p);performance.mark("synapse:pdpServer.createDataSet-end"),performance.measure("synapse:pdpServer.createDataSet","synapse:pdpServer.createDataSet-start","synapse:pdpServer.createDataSet-end");const{txHash:y,statusUrl:c}=l,m=e.getProvider();let h=null;const f=Date.now(),v=g.TRANSACTION_PROPAGATION_TIMEOUT_MS,w=g.TRANSACTION_PROPAGATION_POLL_INTERVAL_MS;for(performance.mark("synapse:getTransaction-start");Date.now()-f<v;){try{if(h=await m.getTransaction(y),null!==h)break}catch(e){console.warn(`Failed to fetch transaction ${y}, retrying...`,e)}await new Promise(e=>setTimeout(e,w))}if(performance.mark("synapse:getTransaction-end"),performance.measure("synapse:getTransaction","synapse:getTransaction-start","synapse:getTransaction-end"),null===h)throw T("StorageContext","create",`Transaction ${y} not found after ${v/1e3} seconds. The transaction may not have propagated to the RPC node.`);try{i?.onDataSetCreationStarted?.(h,c)}catch(e){console.error("Error in onDataSetCreationStarted callback:",e)}let S;performance.mark("synapse:waitForDataSetCreationWithStatus-start");try{S=await t.waitForDataSetCreationWithStatus(h,u,g.DATA_SET_CREATION_TIMEOUT_MS,g.DATA_SET_CREATION_POLL_INTERVAL_MS,async(e,t)=>{if(null!=i?.onDataSetCreationProgress)try{let n;if(e.chainStatus.transactionMined&&null!=e.chainStatus.blockNumber)try{n=await h.wait(g.TRANSACTION_CONFIRMATIONS)??void 0}catch(e){console.error("Failed to fetch transaction receipt:",e)}i.onDataSetCreationProgress({transactionMined:e.chainStatus.transactionMined,transactionSuccess:e.chainStatus.transactionSuccess,dataSetLive:e.chainStatus.dataSetLive,serverConfirmed:!0===e.serverStatus?.ok,dataSetId:e.summary.dataSetId??void 0,elapsedMs:t,receipt:n})}catch(e){console.error("Error in onDataSetCreationProgress callback:",e)}})}catch(e){throw performance.mark("synapse:waitForDataSetCreationWithStatus-end"),performance.measure("synapse:waitForDataSetCreationWithStatus","synapse:waitForDataSetCreationWithStatus-start","synapse:waitForDataSetCreationWithStatus-end"),T("StorageContext","waitForDataSetCreation",e instanceof Error?e.message:"Data set creation failed")}if(performance.mark("synapse:waitForDataSetCreationWithStatus-end"),performance.measure("synapse:waitForDataSetCreationWithStatus","synapse:waitForDataSetCreationWithStatus-start","synapse:waitForDataSetCreationWithStatus-end"),!S.summary.isComplete||null==S.summary.dataSetId)throw T("StorageContext","waitForDataSetCreation",`Data set creation failed: ${S.summary.error??"Transaction may have failed"}`);const P=S.summary.dataSetId;try{i?.onDataSetResolved?.({isExisting:!1,dataSetId:P,provider:n})}catch(e){console.error("Error in onDataSetResolved callback:",e)}return performance.mark("synapse:createDataSet-end"),performance.measure("synapse:createDataSet","synapse:createDataSet-start","synapse:createDataSet-end"),P}static async resolveProviderAndDataSet(e,t,n,r){const i=e.getSigner(),a=await i.getAddress();return null!=r.dataSetId?await Xn.resolveByDataSetId(r.dataSetId,t,n,a,r):null!=r.providerId?await Xn.resolveByProviderId(a,r.providerId,r.withCDN??!1,t,n):null!=r.providerAddress?await Xn.resolveByProviderAddress(r.providerAddress,t,n,a,r.withCDN??!1):await Xn.smartSelectProvider(a,r.withCDN??!1,t,n,i)}static async resolveByDataSetId(e,t,n,r,i){const a=(await t.getClientDataSetsWithDetails(r)).find(t=>t.pdpVerifierDataSetId===e);if(null==a||!a.isLive||!a.isManaged)throw T("StorageContext","resolveByDataSetId",`Data set ${e} not found, not owned by ${r}, or not managed by the current WarmStorage contract`);null==i.providerId&&null==i.providerAddress||await Xn.validateDataSetConsistency(a,i,n);const s=await n.getApprovedProvider(a.providerId);if(null==s)throw T("StorageContext","resolveByDataSetId",`Provider ID ${a.providerId} for data set ${e} is not currently approved`);if(null!=i.withCDN&&a.withCDN!==i.withCDN)throw T("StorageContext","resolveByDataSetId",`Data set ${e} has CDN ${a.withCDN?"enabled":"disabled"}, but requested `+(i.withCDN?"enabled":"disabled"));return{provider:s,dataSetId:e,isExisting:!0}}static async validateDataSetConsistency(e,t,n){if(null!=t.providerId&&e.providerId!==t.providerId)throw T("StorageContext","validateDataSetConsistency",`Data set ${e.pdpVerifierDataSetId} belongs to provider ID ${e.providerId}, but provider ID ${t.providerId} was requested`);if(null!=t.providerAddress){const r=await n.getApprovedProvider(e.providerId);if(null==r||r.serviceProvider.toLowerCase()!==t.providerAddress.toLowerCase())throw T("StorageContext","validateDataSetConsistency",`Data set ${e.pdpVerifierDataSetId} belongs to provider ${r?.serviceProvider??"unknown"}, but provider ${t.providerAddress} was requested`)}}static async resolveByProviderId(e,t,n,r,i){const[a,s]=await Promise.all([i.getApprovedProvider(t),r.getClientDataSetsWithDetails(e)]);if(null==a)throw T("StorageContext","resolveByProviderId",`Provider ID ${t} is not currently approved`);const o=s.filter(e=>e.providerId===a.id&&e.isLive&&e.isManaged&&e.withCDN===n);if(o.length>0){const e=o.sort((e,t)=>e.currentPieceCount>0&&0===t.currentPieceCount?-1:t.currentPieceCount>0&&0===e.currentPieceCount?1:e.pdpVerifierDataSetId-t.pdpVerifierDataSetId);return{provider:a,dataSetId:e[0].pdpVerifierDataSetId,isExisting:!0}}return{provider:a,dataSetId:-1,isExisting:!1}}static async resolveByProviderAddress(e,t,n,r,i){const a=await n.getApprovedProviderByAddress(e);if(null==a)throw T("StorageContext","resolveByProviderAddress",`Provider ${e} is not currently approved`);return await Xn.resolveByProviderId(r,a.id,i,t,n)}static async smartSelectProvider(e,t,n,r,i){const a=(await n.getClientDataSetsWithDetails(e)).filter(e=>e.isLive&&e.isManaged&&e.withCDN===t);if(a.length>0){const o=a.sort((e,t)=>e.currentPieceCount>0&&0===t.currentPieceCount?-1:t.currentPieceCount>0&&0===e.currentPieceCount?1:e.pdpVerifierDataSetId-t.pdpVerifierDataSetId);async function*p(){const e=new Set;for(const t of o){const n=await r.getApprovedProvider(t.providerId);null!=n?e.has(n.serviceProvider.toLowerCase())||(e.add(n.serviceProvider.toLowerCase()),yield n):console.warn(`Provider ID ${t.providerId} for data set ${t.pdpVerifierDataSetId} is not currently approved`)}}try{const d=await Xn.selectProviderWithPing(p()),u=o.find(e=>e.providerId===d.id);if(null!=u)return{provider:d,dataSetId:u.pdpVerifierDataSetId,isExisting:!0};console.warn(`Could not match selected provider ${d.serviceProvider} (ID: ${d.id}) to existing data sets. Falling back to selecting from all providers.`)}catch(l){console.warn("All providers from existing data sets failed health check. Falling back to all providers.")}}const s=await r.getApprovedProviders();if(0===s.length)throw T("StorageContext","smartSelectProvider","No approved service providers available");return{provider:await Xn.selectRandomProvider(s,i),dataSetId:-1,isExisting:!1}}static async selectRandomProvider(e,t){if(0===e.length)throw T("StorageContext","selectRandomProvider","No providers available");return await Xn.selectProviderWithPing(async function*(){const n=[...e];for(;n.length>0;){let e;if(void 0!==globalThis.crypto&&null!=globalThis.crypto.getRandomValues){const t=new Uint8Array(1);globalThis.crypto.getRandomValues(t),e=t[0]%n.length}else{const r=Date.now(),i=Math.random();if(null!=t){const a=r*i*(await t.getAddress()).split("").reduce((e,t)=>e+t.charCodeAt(0),0)%n.length;e=Math.floor(Math.abs(a))}else e=Math.floor(Math.random()*n.length)}const r=n.splice(e,1)[0];yield r}}())}static async selectProviderWithPing(e){let t=0;for await(const n of e){t++;try{if(!n.products.PDP?.data.serviceURL)continue;const e=new qn(null,n.products.PDP.data.serviceURL);return await e.ping(),n}catch(e){console.warn(`Provider ${n.serviceProvider} failed ping test:`,e instanceof Error?e.message:String(e))}}if(0===t)throw T("StorageContext","selectProviderWithPing","No providers available to select from");throw T("StorageContext","selectProviderWithPing",`All ${t} providers failed health check. Storage may be temporarily unavailable.`)}static async performPreflightCheck(e,t,n,r){Xn.validateRawSize(e,"preflightUpload");const i=await n.checkAllowanceForStorage(e,t,r);return{estimatedCost:{perEpoch:i.costs.perEpoch,perDay:i.costs.perDay,perMonth:i.costs.perMonth},allowanceCheck:{sufficient:i.sufficient,message:i.message},selectedProvider:null,selectedDataSetId:null}}async preflightUpload(e){return{...await Xn.performPreflightCheck(e,this._withCDN,this._warmStorageService,this._synapse.payments),selectedProvider:this._provider,selectedDataSetId:this._dataSetId}}async upload(e,t){performance.mark("synapse:upload-start");const n=e instanceof ArrayBuffer?new Uint8Array(e):e,r=n.length;let i;Xn.validateRawSize(r,"upload");try{performance.mark("synapse:pdpServer.uploadPiece-start"),i=await this._pdpServer.uploadPiece(n),performance.mark("synapse:pdpServer.uploadPiece-end"),performance.measure("synapse:pdpServer.uploadPiece","synapse:pdpServer.uploadPiece-start","synapse:pdpServer.uploadPiece-end")}catch(e){throw performance.mark("synapse:pdpServer.uploadPiece-end"),performance.measure("synapse:pdpServer.uploadPiece","synapse:pdpServer.uploadPiece-start","synapse:pdpServer.uploadPiece-end"),T("StorageContext","uploadPiece","Failed to upload piece to service provider",e)}const a=g.PIECE_PARKING_TIMEOUT_MS,s=g.PIECE_PARKING_POLL_INTERVAL_MS,o=Date.now();let p=!1;for(performance.mark("synapse:findPiece-start");Date.now()-o<a;)try{await this._pdpServer.findPiece(i.pieceCid),p=!0;break}catch{Date.now()-o+s<a&&await new Promise(e=>setTimeout(e,s))}if(performance.mark("synapse:findPiece-end"),performance.measure("synapse:findPiece","synapse:findPiece-start","synapse:findPiece-end"),!p)throw T("StorageContext","findPiece","Timeout waiting for piece to be parked on service provider");null!=t?.onUploadComplete&&t.onUploadComplete(i.pieceCid);const d=i.pieceCid,u=await new Promise((e,n)=>{this._pendingPieces.push({pieceData:d,resolve:e,reject:n,callbacks:t}),setTimeout(()=>{this._processPendingPieces().catch(e=>{console.error("Failed to process pending pieces batch:",e)})},0)});return performance.mark("synapse:upload-end"),performance.measure("synapse:upload","synapse:upload-start","synapse:upload-end"),{pieceCid:i.pieceCid,size:i.size,pieceId:u}}async _processPendingPieces(){if(this._isProcessing||0===this._pendingPieces.length)return;this._isProcessing=!0;const e=this._pendingPieces.slice(0,this._uploadBatchSize);this._pendingPieces=this._pendingPieces.slice(this._uploadBatchSize);try{performance.mark("synapse:getAddPiecesInfo-start");const t=await this._warmStorageService.getAddPiecesInfo(this._dataSetId);performance.mark("synapse:getAddPiecesInfo-end"),performance.measure("synapse:getAddPiecesInfo","synapse:getAddPiecesInfo-start","synapse:getAddPiecesInfo-end");const n=e.map(e=>e.pieceData);performance.mark("synapse:pdpServer.addPieces-start");const r=await this._pdpServer.addPieces(this._dataSetId,t.clientDataSetId,t.nextPieceId,n);performance.mark("synapse:pdpServer.addPieces-end"),performance.measure("synapse:pdpServer.addPieces","synapse:pdpServer.addPieces-start","synapse:pdpServer.addPieces-end");let i=[];if(null==r.txHash)throw T("StorageContext","addPieces","Server did not return a transaction hash for piece addition");let a=null;const s=Date.now(),o=g.TRANSACTION_PROPAGATION_TIMEOUT_MS,p=g.TRANSACTION_PROPAGATION_POLL_INTERVAL_MS;for(performance.mark("synapse:getTransaction.addPieces-start");Date.now()-s<o;){try{if(a=await this._synapse.getProvider().getTransaction(r.txHash),null!==a)break}catch{}await new Promise(e=>setTimeout(e,p))}if(performance.mark("synapse:getTransaction.addPieces-end"),performance.measure("synapse:getTransaction.addPieces","synapse:getTransaction.addPieces-start","synapse:getTransaction.addPieces-end"),null==a)throw T("StorageContext","addPieces",`Server returned transaction hash ${r.txHash} but transaction was not found on-chain after ${o/1e3} seconds`);let d;e.forEach(e=>{e.callbacks?.onPieceAdded?.(a)});try{performance.mark("synapse:transaction.wait-start"),d=await a.wait(g.TRANSACTION_CONFIRMATIONS),performance.mark("synapse:transaction.wait-end"),performance.measure("synapse:transaction.wait","synapse:transaction.wait-start","synapse:transaction.wait-end")}catch(e){throw performance.mark("synapse:transaction.wait-end"),performance.measure("synapse:transaction.wait","synapse:transaction.wait-start","synapse:transaction.wait-end"),T("StorageContext","addPieces","Failed to wait for transaction confirmation",e)}if(1!==d?.status)throw T("StorageContext","addPieces","Piece addition transaction  failed on-chain");const u=g.PIECE_ADDITION_TIMEOUT_MS,l=g.PIECE_ADDITION_POLL_INTERVAL_MS,y=Date.now();let c=null,m=!1;for(performance.mark("synapse:getPieceAdditionStatus-start");Date.now()-y<u;)try{const t=await this._pdpServer.getPieceAdditionStatus(this._dataSetId,r.txHash);if("pending"===t.txStatus||null===t.addMessageOk){await new Promise(e=>setTimeout(e,l));continue}if(!t.addMessageOk)throw new Error("Piece addition failed: Transaction was unsuccessful");if(null!=t.confirmedPieceIds&&t.confirmedPieceIds.length>0){i=t.confirmedPieceIds,e.forEach(e=>{e.callbacks?.onPieceConfirmed?.(t.confirmedPieceIds??[])}),m=!0;break}await new Promise(e=>setTimeout(e,l))}catch(e){if(c=e,e instanceof Error&&e.message.includes("not found")){await new Promise(e=>setTimeout(e,l));continue}throw T("StorageContext","addPieces",`Failed to verify piece addition with server: ${e instanceof Error?e.message:"Unknown error"}`,e)}if(performance.mark("synapse:getPieceAdditionStatus-end"),performance.measure("synapse:getPieceAdditionStatus","synapse:getPieceAdditionStatus-start","synapse:getPieceAdditionStatus-end"),!m)throw T("StorageContext","addPieces",`Failed to verify piece addition after ${u/1e3} seconds: ${null!=c?c.message:"Server did not provide confirmation"}. The transaction was confirmed on-chain but the server failed to acknowledge it.`,c);e.forEach((e,n)=>{const r=i[n]??t.nextPieceId+n;e.resolve(r)})}catch(t){const n=T("StorageContext","addPieces","Failed to add piece to data set",t);e.forEach(e=>{e.reject(n)})}finally{this._isProcessing=!1,this._pendingPieces.length>0&&this._processPendingPieces().catch(e=>{console.error("Failed to process pending pieces batch:",e)})}}async download(e,t){const n=this._synapse.storage?.download??this._synapse.download;return await n.call(this._synapse.storage??this._synapse,e,{providerAddress:this._provider.serviceProvider,withCDN:t?.withCDN??this._withCDN})}async providerDownload(e,t){return console.warn("providerDownload() is deprecated. Use download() instead."),await this.download(e,t)}async getProviderInfo(){return await this._synapse.getProviderInfo(this.serviceProvider)}async getDataSetPieces(){return(await this._pdpServer.getDataSet(this._dataSetId)).pieces.map(e=>e.pieceCid)}async hasPiece(e){const t=Nn(e);if(null==t)return!1;try{return await this._pdpServer.findPiece(t),!0}catch{return!1}}async pieceStatus(e){const t=Nn(e);if(null==t)throw T("StorageContext","pieceStatus","Invalid PieceCID provided");const[n,r,i]=await Promise.all([this.hasPiece(t),this._pdpServer.getDataSet(this._dataSetId).catch(e=>(console.debug("Failed to get data set data:",e),null)),A(this._synapse.getProvider())]),a=this._synapse.getNetwork();let s,o=null,p=null,d=null,u=!1,l=0,y=!1;if(n){const[e,n]=await Promise.all([this.getProviderInfo().catch(()=>null),null!=r?Promise.all([this._warmStorageService.getMaxProvingPeriod(),this._warmStorageService.getChallengeWindow()]).then(([e,t])=>({maxProvingPeriod:e,challengeWindow:t})).catch(()=>null):Promise.resolve(null)]);if(null!=e){if(!e.products.PDP?.data.serviceURL)throw new Error(`Provider ${e.id} does not have a PDP product with serviceURL`);o=`${e.products.PDP.data.serviceURL.replace(/\/$/,"")}/piece/${t.toString()}`}if(null!=r&&null!=n){const e=r.pieces.find(e=>e.pieceCid.toString()===t.toString());if(null!=e)if(s=e.pieceId,r.nextChallengeEpoch>0){const e=r.nextChallengeEpoch,t=e+n.challengeWindow;d=S(t,a);const s=C(r.nextChallengeEpoch,n.maxProvingPeriod,a);null!=s&&(p=s),u=Number(i)>=e&&Number(i)<t,y=Number(i)>=t,Number(i)<e&&(l=I(e,Number(i)).hours)}else console.debug("Data set has nextChallengeEpoch=0, may have just been proven")}}return{exists:n,dataSetLastProven:p,dataSetNextProofDue:d,retrievalUrl:o,pieceId:s,inChallengeWindow:u,hoursUntilChallengeWindow:l,isProofOverdue:y}}}class Jn{_synapse;_warmStorageService;_pieceRetriever;_withCDN;_defaultContext;constructor(e,t,n,r){this._synapse=e,this._warmStorageService=t,this._pieceRetriever=n,this._withCDN=r}async upload(e,t){if(null!=t?.context){const e=[];if(void 0!==t.providerId&&e.push("providerId"),void 0!==t.providerAddress&&e.push("providerAddress"),void 0!==t.dataSetId&&e.push("dataSetId"),void 0!==t.withCDN&&e.push("withCDN"),void 0!==t.forceCreateDataSet&&e.push("forceCreateDataSet"),void 0!==t.uploadBatchSize&&e.push("uploadBatchSize"),e.length>0)throw T("StorageManager","upload",`Cannot specify both 'context' and other options: ${e.join(", ")}`)}const n=t?.context??await this.createContext({providerId:t?.providerId,providerAddress:t?.providerAddress,dataSetId:t?.dataSetId,withCDN:t?.withCDN,forceCreateDataSet:t?.forceCreateDataSet,uploadBatchSize:t?.uploadBatchSize,callbacks:t?.callbacks});return await n.upload(e,t?.callbacks)}async download(e,t){if(null!=t?.context){const n=[];if(void 0!==t.providerAddress&&n.push("providerAddress"),void 0!==t.withCDN&&n.push("withCDN"),n.length>0)throw T("StorageManager","download",`Cannot specify both 'context' and other options: ${n.join(", ")}`);return await t.context.download(e,t)}const n=Nn(e);if(null==n)throw T("StorageManager","download",`Invalid PieceCID: ${String(e)}`);const r=t?.withCDN??this._withCDN;if(null!=this._defaultContext&&!r&&null==t?.providerAddress&&!1===(this._defaultContext._withCDN??this._withCDN)&&await this._defaultContext.hasPiece(n))return await this._defaultContext.download(e,t);const i=await this._synapse.getSigner().getAddress(),a=await this._pieceRetriever.fetchPiece(n,i,{providerAddress:t?.providerAddress,withCDN:r});return await R(a,n)}async preflightUpload(e,t){const n=t?.withCDN??this._withCDN;return await Xn.performPreflightCheck(e,n,this._warmStorageService,this._synapse.payments)}async createContext(e){const t=e?.withCDN??this._withCDN;if(null==e||null==e.providerId&&null==e.providerAddress&&null==e.dataSetId&&!0!==e.forceCreateDataSet&&null==e.uploadBatchSize){if(null!=this._defaultContext&&(this._defaultContext.withCDN??this._withCDN)===t){if(null!=e?.callbacks){try{e.callbacks.onProviderSelected?.(this._defaultContext.provider)}catch(e){console.error("Error in onProviderSelected callback:",e)}try{e.callbacks.onDataSetResolved?.({isExisting:!0,dataSetId:this._defaultContext.dataSetId,provider:this._defaultContext.provider})}catch(e){console.error("Error in onDataSetResolved callback:",e)}}return this._defaultContext}const n=await Xn.create(this._synapse,this._warmStorageService,{withCDN:t,callbacks:e?.callbacks});return this._defaultContext=n,n}return await Xn.create(this._synapse,this._warmStorageService,{...e,withCDN:t})}async getDefaultContext(){return await this.createContext()}async findDataSets(e){const t=e??await this._synapse.getSigner().getAddress();return await this._warmStorageService.getClientDataSetsWithDetails(t)}async getStorageInfo(){try{const e=async()=>{try{const e=this._synapse.getWarmStorageAddress(),t=await this._synapse.payments.serviceApproval(e,l.USDFC);return{service:e,rateAllowance:t.rateAllowance,lockupAllowance:t.lockupAllowance,rateUsed:t.rateUsed,lockupUsed:t.lockupUsed}}catch{return null}},t=this._warmStorageService.getServiceProviderRegistryAddress(),n=new Qn(this._synapse.getProvider(),t),r=new Yn(this._warmStorageService,n),[i,a,s]=await Promise.all([this._warmStorageService.getServicePrice(),r.getApprovedProviders(),e()]),o=BigInt(i.epochsPerMonth),p=BigInt(i.pricePerTiBPerMonthNoCDN)/o,d=BigInt(i.pricePerTiBPerMonthWithCDN)/o,y=BigInt(i.pricePerTiBPerMonthNoCDN)/m.DAYS_PER_MONTH,c=BigInt(i.pricePerTiBPerMonthWithCDN)/m.DAYS_PER_MONTH,h=a.filter(e=>e.serviceProvider!==u.ethers.ZeroAddress),g=this._synapse.getNetwork();return{pricing:{noCDN:{perTiBPerMonth:BigInt(i.pricePerTiBPerMonthNoCDN),perTiBPerDay:y,perTiBPerEpoch:p},withCDN:{perTiBPerMonth:BigInt(i.pricePerTiBPerMonthWithCDN),perTiBPerDay:c,perTiBPerEpoch:d},tokenAddress:i.tokenAddress,tokenSymbol:"USDFC"},providers:h,serviceParameters:{network:g,epochsPerMonth:o,epochsPerDay:m.EPOCHS_PER_DAY,epochDuration:m.EPOCH_DURATION,minUploadSize:f.MIN_UPLOAD_SIZE,maxUploadSize:f.MAX_UPLOAD_SIZE,warmStorageAddress:this._synapse.getWarmStorageAddress(),paymentsAddress:this._warmStorageService.getPaymentsAddress(),pdpVerifierAddress:this._warmStorageService.getPDPVerifierAddress()},allowances:s}}catch(e){throw new Error(`Failed to get storage service information: ${e instanceof Error?e.message:String(e)}`)}}}const er="\n    query GetApprovedProvidersForCommP($cid: Bytes!) {\n      pieces(where: { cid: $cid }) {\n        id\n        dataSet {\n          setId\n          owner {\n            id\n            address\n            pdpUrl\n            pieceRetrievalUrl\n            registeredAt\n            status\n            approvedAt\n          }\n        }\n      }\n    }\n  ",tr="\n    query Provider($providerId: ID!) {\n      provider(id: $providerId) {\n        id\n        address\n        pdpUrl\n        pieceRetrievalUrl\n        registeredAt\n        approvedAt\n      }\n    }\n  ",nr="\n    query ProvidersFlexible($where: Provider_filter, $first: Int, $skip: Int, $orderBy: Provider_orderBy, $orderDirection: OrderDirection) {\n      providers(\n        where: $where\n        first: $first\n        skip: $skip\n        orderBy: $orderBy\n        orderDirection: $orderDirection\n      ) {\n        id\n        address\n        pdpUrl\n        pieceRetrievalUrl\n        registeredAt\n        approvedAt\n        status\n        totalFaultedPeriods\n        totalFaultedPieces\n        totalDataSets\n        totalPieces\n        totalDataSize\n        createdAt\n        updatedAt\n      }\n    }\n  ",rr="\n    query DataSetsFlexible($where: DataSet_filter, $first: Int, $skip: Int, $orderBy: DataSet_orderBy, $orderDirection: OrderDirection) {\n      dataSets(\n        where: $where\n        first: $first\n        skip: $skip\n        orderBy: $orderBy\n        orderDirection: $orderDirection\n      ) {\n        id\n        setId\n        listener\n        clientAddr\n        withCDN\n        isActive\n        leafCount\n        challengeRange\n        lastProvenEpoch\n        nextChallengeEpoch\n        totalPieces\n        totalDataSize\n        totalProofs\n        totalProvedPieces\n        totalFaultedPeriods\n        totalFaultedPieces\n        metadata\n        createdAt\n        updatedAt\n        owner {\n          id\n          address\n          pdpUrl\n          pieceRetrievalUrl\n          registeredAt\n          approvedAt\n        }\n        rail {\n          id\n          railId\n          token\n          paymentRate\n          lockupPeriod\n          settledUpto\n          endEpoch\n        }\n      }\n    }\n  ",ir="\n    query PiecesFlexible($where: Piece_filter, $first: Int, $skip: Int, $orderBy: Piece_orderBy, $orderDirection: OrderDirection) {\n      pieces(\n        where: $where\n        first: $first\n        skip: $skip\n        orderBy: $orderBy\n        orderDirection: $orderDirection\n      ) {\n        id\n        setId\n        pieceId\n        rawSize\n        leafCount\n        cid\n        removed\n        totalProofsSubmitted\n        totalPeriodsFaulted\n        lastProvenEpoch\n        lastProvenAt\n        lastFaultedEpoch\n        lastFaultedAt\n        createdAt\n        metadata\n        dataSet {\n          id\n          setId\n          isActive\n          owner {\n            id\n            address\n            pdpUrl\n            pieceRetrievalUrl\n            registeredAt\n            approvedAt\n          }\n        }\n      }\n    }\n  ",ar="\n    query FaultRecordsFlexible($where: FaultRecord_filter, $first: Int, $skip: Int, $orderBy: FaultRecord_orderBy, $orderDirection: OrderDirection) {\n      faultRecords(\n        where: $where\n        first: $first\n        skip: $skip\n        orderBy: $orderBy\n        orderDirection: $orderDirection\n      ) {\n        id\n        dataSetId\n        pieceIds\n        currentChallengeEpoch\n        nextChallengeEpoch\n        periodsFaulted\n        deadline\n        createdAt\n        dataSet {\n          id\n          setId\n          owner {\n            id\n            address\n            pdpUrl\n            pieceRetrievalUrl\n            registeredAt\n            approvedAt\n          }\n        }\n      }\n    }\n  ";class sr{endpoint;headers;constructor(e){this.endpoint=this.resolveEndpoint(e),this.headers=this.buildHeaders(e.apiKey)}resolveEndpoint(e){if(null!=e.endpoint&&""!==e.endpoint.trim())return e.endpoint.trim();if(null!=e.goldsky)return this.buildGoldskyEndpoint(e.goldsky);throw T("SubgraphService","constructor","Invalid configuration: provide either endpoint or complete goldsky config")}buildGoldskyEndpoint(e){const{projectId:t,subgraphName:n,version:r}=e;if(null==t?.trim()||""===t?.trim()||null==n?.trim()||""===n?.trim()||null==r?.trim()||""===r?.trim())throw T("SubgraphService","constructor","Incomplete Goldsky config: projectId, subgraphName, and version required");return`https://api.goldsky.com/api/public/${t}/subgraphs/${n}/${r}/gn`}buildHeaders(e){const t={"Content-Type":"application/json"};return null!=e&&""!==e?{...t,Authorization:`Bearer ${e}`}:t}normalizeQueryOptions(e={}){return{where:{},first:10,skip:0,orderBy:"createdAt",orderDirection:"desc",...e}}async executeQuery(e,t,n){try{const r=await fetch(this.endpoint,{method:"POST",headers:this.headers,body:JSON.stringify({query:e,variables:t})});if(!r.ok){const e=await r.text();throw T("SubgraphService",n,`HTTP ${r.status}: ${e}`)}const i=await r.json();if(null!=i.errors&&i.errors.length>0)throw T("SubgraphService",n,`GraphQL errors: ${i.errors.map(e=>e.message).join("; ")}`);return i.data}catch(e){if(e instanceof Error&&"SynapseError"===e.name)throw e;throw T("SubgraphService",n,`Query execution failed: ${e.message}`,{cause:e})}}transformProviderData(e){const t=e.serviceURL??e.pdpUrl??"https://unknown.provider";return{id:1,serviceProvider:e.serviceProvider??e.serviceProvider??e.id,payee:e.payee??e.serviceProvider??e.id,name:"Subgraph Provider",description:"Provider from subgraph",active:!0,products:{PDP:{type:"PDP",isActive:!0,capabilities:{},data:{serviceURL:t,minPieceSizeInBytes:BigInt(1024),maxPieceSizeInBytes:BigInt(1073741824),ipniPiece:!1,ipniIpfs:!1,storagePricePerTibPerMonth:BigInt(1e6),minProvingPeriodInEpochs:2880,location:"Unknown",paymentTokenAddress:"0x0000000000000000000000000000000000000000"}}}}}parseTimestamp(e){if(null==e)return 0;const t=Number(e);return Number.isNaN(t)?0:t}safeConvertHexToCid(e){try{const t=function(e){const t=e.match(/../g);return null!=t?new Uint8Array(t.map(e=>parseInt(e,16))):B}(e.startsWith("0x")?e.slice(2):e),n=Nn(Jt.decode(t));if(null==n)throw new Error(`Failed to convert CID to PieceCID format: ${e}`);return n}catch(e){return console.warn(`SubgraphService: queryProviders: Failed to convert CID to PieceCID format: ${e instanceof Error?e.message:"Unknown error"}`),null}}isValidProviderData(e){return null!=e?.id&&""!==e.id.trim()&&null!=e?.serviceURL&&""!==e.serviceURL.trim()}async getApprovedProvidersForPieceCID(e){const t=Nn(e);if(null==t)throw T("SubgraphService","getApprovedProvidersForPieceCID","Invalid PieceCID");const n=t.bytes.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),""),r=await this.executeQuery(er,{cid:n},"getApprovedProvidersForPieceCID");if(null==r?.pieces||0===r.pieces.length)return console.log(`SubgraphService: No providers found for PieceCID: ${t.toString()}`),[];const i=r.pieces.reduce((e,t)=>{const n=t.dataSet.serviceProvider,r=n?.serviceProvider?.toLowerCase();return"Approved"!==n?.status||null==r||""===r||e.has(r)?e:this.isValidProviderData(n)?(e.set(r,n),e):(console.warn("SubgraphService: Skipping incomplete provider data for approved provider:",n),e)},new Map);return Array.from(i.values()).map(e=>this.transformProviderData(e))}async getProviderByAddress(e){const t=await this.executeQuery(tr,{providerId:e},"getProviderByAddress");return null==t?.provider?(console.log(`SubgraphService: No provider found for address: ${e}`),null):this.transformProviderData(t.provider)}async queryProviders(e={}){const t=await this.executeQuery(nr,this.normalizeQueryOptions(e),"queryProviders");return null==t?.providers||0===t?.providers?.length?(console.log("SubgraphService: No providers found for the given criteria"),[]):t.providers.filter(e=>this.isValidProviderData(e)).map(e=>this.transformProviderData(e))}async queryDataSets(e={}){const t=await this.executeQuery(rr,this.normalizeQueryOptions(e),"queryDataSets");return null==t?.dataSets||0===t?.dataSets?.length?(console.log("SubgraphService: No data sets found for the given criteria"),[]):t.dataSets.map(e=>({id:e.id,setId:this.parseTimestamp(e.setId),listener:e.listener??"",clientAddr:e.clientAddr??"",withCDN:e.withCDN??!1,isActive:e.isActive,leafCount:this.parseTimestamp(e.leafCount),challengeRange:this.parseTimestamp(e.challengeRange),lastProvenEpoch:this.parseTimestamp(e.lastProvenEpoch),nextChallengeEpoch:this.parseTimestamp(e.nextChallengeEpoch),totalPieces:this.parseTimestamp(e.totalPieces),totalDataSize:this.parseTimestamp(e.totalDataSize),totalProofs:this.parseTimestamp(e.totalProofs),totalProvedPieces:this.parseTimestamp(e.totalProvedPieces),totalFaultedPeriods:this.parseTimestamp(e.totalFaultedPeriods),totalFaultedPieces:this.parseTimestamp(e.totalFaultedPieces),metadata:e.metadata??"",createdAt:this.parseTimestamp(e.createdAt),updatedAt:this.parseTimestamp(e.updatedAt),owner:null!=e.owner?this.transformProviderData(e.owner):this.transformProviderData({}),serviceProvider:null!=e.serviceProvider?this.transformProviderData(e.serviceProvider):this.transformProviderData({}),rail:null!=e.rail?{id:e.rail.id,railId:this.parseTimestamp(e.rail.railId),token:e.rail.token,paymentRate:this.parseTimestamp(e.rail.paymentRate),lockupPeriod:this.parseTimestamp(e.rail.lockupPeriod),settledUpto:this.parseTimestamp(e.rail.settledUpto),endEpoch:this.parseTimestamp(e.rail.endEpoch)}:void 0}))}async queryPieces(e={}){const t=await this.executeQuery(ir,this.normalizeQueryOptions(e),"queryPieces");return null==t?.pieces||0===t?.pieces?.length?(console.log("SubgraphService: No pieces found for the given criteria"),[]):t.pieces.map(e=>({id:e.id,setId:this.parseTimestamp(e.setId),pieceId:this.parseTimestamp(e.pieceId),rawSize:this.parseTimestamp(e.rawSize),leafCount:this.parseTimestamp(e.leafCount),cid:this.safeConvertHexToCid(e.cid),removed:e.removed,totalProofsSubmitted:this.parseTimestamp(e.totalProofsSubmitted),totalPeriodsFaulted:this.parseTimestamp(e.totalPeriodsFaulted),lastProvenEpoch:this.parseTimestamp(e.lastProvenEpoch),lastProvenAt:this.parseTimestamp(e.lastProvenAt),lastFaultedEpoch:this.parseTimestamp(e.lastFaultedEpoch),lastFaultedAt:this.parseTimestamp(e.lastFaultedAt),createdAt:this.parseTimestamp(e.createdAt),metadata:e.metadata??"",dataSet:{id:e.dataSet.id,setId:this.parseTimestamp(e.dataSet.setId),isActive:e.dataSet.isActive,serviceProvider:this.transformProviderData(e.dataSet.serviceProvider)}}))}async queryFaultRecords(e={}){const t=await this.executeQuery(ar,this.normalizeQueryOptions(e),"queryFaultRecords");return null==t?.faultRecords||0===t?.faultRecords?.length?(console.log("SubgraphService: No fault records found for the given criteria"),[]):t.faultRecords.map(e=>({id:e.id,dataSetId:this.parseTimestamp(e.dataSetId),pieceIds:e.pieceIds.map(e=>this.parseTimestamp(e)),currentChallengeEpoch:this.parseTimestamp(e.currentChallengeEpoch),nextChallengeEpoch:this.parseTimestamp(e.nextChallengeEpoch),periodsFaulted:this.parseTimestamp(e.periodsFaulted),deadline:this.parseTimestamp(e.deadline),createdAt:this.parseTimestamp(e.createdAt),dataSet:{id:e.dataSet.id,setId:this.parseTimestamp(e.dataSet.setId),serviceProvider:this.transformProviderData(e.dataSet.serviceProvider)}}))}}async function or(e,t,n,r){const i=[],a=[],s=e.map(async(e,n)=>{const s=new AbortController;a[n]=s,null!=r&&(r.addEventListener("abort",()=>{s.abort(r.reason)},{once:!0}),r.aborted&&s.abort(r.reason));try{if(!e.products.PDP?.data.serviceURL)throw new Error(`Provider ${e.id} does not have PDP product with serviceURL`);const r=E(e.products.PDP.data.serviceURL,t),a=await fetch(r,{signal:s.signal});if(!a.ok)throw i.push({provider:e.serviceProvider,error:`findPiece returned ${a.status}`}),new Error("Provider does not have piece");const o=_(e.products.PDP.data.serviceURL,t),p=await fetch(o,{signal:s.signal});if(p.ok)return{response:p,index:n};throw i.push({provider:e.serviceProvider,error:`download returned ${p.status}`}),new Error(`Download failed with status ${p.status}`)}catch(t){const n=t.message??"Unknown error";throw i.some(t=>t.provider===e.serviceProvider)||i.push({provider:e.serviceProvider,error:n}),console.warn(`Failed to fetch from provider ${e.serviceProvider}:`,n),t}});try{const{response:e,index:t}=await Promise.any(s);return a.forEach((e,n)=>{n!==t&&e.abort()}),e}catch(e){if(e instanceof AggregateError){const e=i.map(e=>`${e.provider}: ${e.error}`).join("; ");throw T(n,"fetchPiecesFromProviders",`All providers failed to serve piece ${t.toString()}. Details: ${e}`)}throw e}}class pr{warmStorageService;childRetriever;spRegistry;constructor(e,t,n){this.warmStorageService=e,this.spRegistry=t,this.childRetriever=n}async findProviders(e,t){const n=new Yn(this.warmStorageService,this.spRegistry);if(null!=t){const e=await n.getApprovedProviderByAddress(t);if(null==e)throw T("ChainRetriever","findProviders",`Provider ${t} not found or not approved`);return[e]}const r=(await this.warmStorageService.getClientDataSetsWithDetails(e)).filter(e=>e.isLive&&e.currentPieceCount>0);if(0===r.length)throw T("ChainRetriever","findProviders",`No active data sets with data found for client ${e}`);const i=[...new Set(r.map(e=>e.providerId))],a=(await n.getApprovedProvidersByIds(i)).filter(e=>null!=e);if(0===a.length)throw T("ChainRetriever","findProviders","No valid providers found (all providers may have been removed or are inactive)");return a}async fetchPiece(e,t,n){const r=async r=>{if(void 0!==this.childRetriever)return await this.childRetriever.fetchPiece(e,t,n);throw T("ChainRetriever","fetchPiece",`Failed to retrieve piece ${e.toString()}: ${r}`)};let i=[];try{i=await this.findProviders(t,n?.providerAddress)}catch(e){const t=e instanceof Error?e.message:"Provider discovery failed";return await r(t)}if(0===i.length)return await r("No providers found and no additional retriever method was configured");try{return await or(i,e,"ChainRetriever",n?.signal)}catch{return await r("All provider retrieval attempts failed and no additional retriever method was configured")}}}class dr{baseRetriever;network;constructor(e,t){this.baseRetriever=e,this.network=t}hostname(){return"mainnet"===this.network?"filcdn.io":"calibration.filcdn.io"}async fetchPiece(e,t,n){if(!0===n?.withCDN){const r=`https://${t}.${this.hostname()}/${e.toString()}`;try{const e=await fetch(r,{signal:n?.signal});if(e.ok)return e;402===e.status?console.warn("CDN requires payment. Please initialise Synapse SDK with the option `withCDN: true` and re-upload your files."):console.warn("CDN fetch failed with status:",e.status)}catch(e){console.warn("CDN fetch failed:",e)}}return console.log("Falling back to direct retrieval"),await this.baseRetriever.fetchPiece(e,t,n)}}class ur{subgraphService;childRetriever;constructor(e,t){this.subgraphService=e,this.childRetriever=t}async findProviders(e,t){if(null!=t){const e=await this.subgraphService.getProviderByAddress(t);return null!==e?[e]:[]}return await this.subgraphService.getApprovedProvidersForPieceCID(e)}async fetchPiece(e,t,n){const r=async r=>{if(void 0!==this.childRetriever)return await this.childRetriever.fetchPiece(e,t,n);throw T("SubgraphRetriever","fetchPiece",`Failed to retrieve piece ${e.toString()}: ${r}`)};let i=[];try{i=await this.findProviders(e,n?.providerAddress)}catch{return await r("Provider discovery failed and no additional retriever method was configured")}if(0===i.length)return await r("No providers found and no additional retriever method was configured");try{return await or(i,e,"SubgraphRetriever",n?.signal)}catch{return await r("All provider retrieval attempts failed and no additional retriever method was configured")}}}class lr{_provider;_warmStorageAddress;_warmStorageContract=null;_warmStorageViewContract=null;_pdpVerifier=null;_addresses;constructor(e,t,n){this._provider=e,this._warmStorageAddress=t,this._addresses=n}static async create(e,t){const n=await D(e),r=new u.ethers.Contract(w.MULTICALL3[n],c.MULTICALL3,e),i=new u.ethers.Interface(c.WARM_STORAGE),a=[{target:t,allowFailure:!1,callData:i.encodeFunctionData("pdpVerifierAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("paymentsContractAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("usdfcTokenAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("filCDNBeneficiaryAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("viewContractAddress")},{target:t,allowFailure:!1,callData:i.encodeFunctionData("serviceProviderRegistry")}],s=await r.aggregate3.staticCall(a),o={pdpVerifier:i.decodeFunctionResult("pdpVerifierAddress",s[0].returnData)[0],payments:i.decodeFunctionResult("paymentsContractAddress",s[1].returnData)[0],usdfcToken:i.decodeFunctionResult("usdfcTokenAddress",s[2].returnData)[0],filCDNBeneficiary:i.decodeFunctionResult("filCDNBeneficiaryAddress",s[3].returnData)[0],viewContract:i.decodeFunctionResult("viewContractAddress",s[4].returnData)[0],serviceProviderRegistry:i.decodeFunctionResult("serviceProviderRegistry",s[5].returnData)[0]};return new lr(e,t,o)}getPDPVerifierAddress(){return this._addresses.pdpVerifier}getPaymentsAddress(){return this._addresses.payments}getUSDFCTokenAddress(){return this._addresses.usdfcToken}getViewContractAddress(){return this._addresses.viewContract}getServiceProviderRegistryAddress(){return this._addresses.serviceProviderRegistry}getProvider(){return this._provider}_getWarmStorageContract(){return null==this._warmStorageContract&&(this._warmStorageContract=new u.ethers.Contract(this._warmStorageAddress,c.WARM_STORAGE,this._provider)),this._warmStorageContract}_getWarmStorageViewContract(){if(null==this._warmStorageViewContract){const e=this.getViewContractAddress();this._warmStorageViewContract=new u.ethers.Contract(e,c.WARM_STORAGE_VIEW,this._provider)}return this._warmStorageViewContract}_getPDPVerifier(){if(null==this._pdpVerifier){const e=this.getPDPVerifierAddress();this._pdpVerifier=new Zn(this._provider,e)}return this._pdpVerifier}async getClientDataSets(e){try{const t=this._getWarmStorageViewContract();return(await t.getClientDataSets(e)).map(e=>({pdpRailId:Number(e.pdpRailId),cacheMissRailId:Number(e.cacheMissRailId),cdnRailId:Number(e.cdnRailId),payer:e.payer,payee:e.payee,commissionBps:Number(e.commissionBps),clientDataSetId:Number(e.clientDataSetId),paymentEndEpoch:Number(e.paymentEndEpoch),providerId:Number(e.providerId)}))}catch(e){throw new Error(`Failed to get client data sets: ${e instanceof Error?e.message:String(e)}`)}}async getClientDataSetsWithDetails(e,t=!1){const n=await this.getClientDataSets(e),r=this._getPDPVerifier(),i=this._getWarmStorageViewContract(),a=n.map(async e=>{try{const n=Number(await i.railToDataSet(e.pdpRailId));if(0===e.pdpRailId)return t?null:{...e,pdpVerifierDataSetId:0,nextPieceId:0,currentPieceCount:0,isLive:!1,isManaged:!1,withCDN:e.cdnRailId>0};const[a,s]=await Promise.all([r.dataSetLive(n),r.getDataSetListener(n).catch(()=>null)]),o=null!=s&&s.toLowerCase()===this._warmStorageAddress.toLowerCase();if(t&&!o)return null;const p=a?await r.getNextPieceId(n):0;return{...e,pdpVerifierDataSetId:n,nextPieceId:Number(p),currentPieceCount:Number(p),isLive:a,isManaged:o,withCDN:e.cdnRailId>0}}catch(t){throw new Error(`Failed to get details for data set with enhanced info ${e.pdpRailId}: ${t instanceof Error?t.message:String(t)}`)}});return(await Promise.all(a)).filter(e=>null!==e)}async getAddPiecesInfo(e){try{const t=this._getWarmStorageViewContract(),n=this._getPDPVerifier(),[r,i,a,s]=await Promise.all([n.dataSetLive(Number(e)),n.getNextPieceId(Number(e)),n.getDataSetListener(Number(e)),t.getDataSet(Number(e))]);if(!r)throw new Error(`Data set ${e} does not exist or is not live`);if(a.toLowerCase()!==this._warmStorageAddress.toLowerCase())throw new Error(`Data set ${e} is not managed by this WarmStorage contract (${this._warmStorageAddress}), managed by ${String(a)}`);const o=Number(s.clientDataSetId);return{nextPieceId:Number(i),clientDataSetId:o,currentPieceCount:Number(i)}}catch(e){throw new Error(`Failed to get add pieces info: ${e instanceof Error?e.message:String(e)}`)}}async getNextClientDataSetId(e){try{const t=this._getWarmStorageViewContract(),n=await t.clientDataSetIDs(e);return Number(n)}catch(e){throw new Error(`Failed to get next client dataset ID: ${e instanceof Error?e.message:String(e)}`)}}async verifyDataSetCreation(e){try{const t="string"==typeof e?e:e.hash;let n;if(n="string"==typeof e?await this._provider.getTransactionReceipt(t):await e.wait(g.TRANSACTION_CONFIRMATIONS),null==n)return{transactionMined:!1,transactionSuccess:!1,dataSetLive:!1};if(1!==n.status)return{transactionMined:!0,transactionSuccess:!1,dataSetLive:!1,blockNumber:n.blockNumber,gasUsed:n.gasUsed,error:"Transaction failed"};const r=this._getPDPVerifier(),i=await r.extractDataSetIdFromReceipt(n);return null==i?{transactionMined:!0,transactionSuccess:!0,dataSetLive:!1,blockNumber:n.blockNumber,gasUsed:n.gasUsed,error:"Could not find DataSetCreated event in transaction"}:{transactionMined:!0,transactionSuccess:!0,dataSetId:i,dataSetLive:await r.dataSetLive(i),blockNumber:n.blockNumber,gasUsed:n.gasUsed}}catch(e){return{transactionMined:!1,transactionSuccess:!1,dataSetLive:!1,error:e instanceof Error?e.message:"Unknown error"}}}async getComprehensiveDataSetStatus(e,t){const n="string"==typeof e?e:e.hash;let r=null;if(null!=t)try{performance.mark("synapse:pdpServer.getDataSetCreationStatus-start"),r=await t.getDataSetCreationStatus(n),performance.mark("synapse:pdpServer.getDataSetCreationStatus-end"),performance.measure("synapse:pdpServer.getDataSetCreationStatus","synapse:pdpServer.getDataSetCreationStatus-start","synapse:pdpServer.getDataSetCreationStatus-end")}catch{performance.mark("synapse:pdpServer.getDataSetCreationStatus-end"),performance.measure("synapse:pdpServer.getDataSetCreationStatus","synapse:pdpServer.getDataSetCreationStatus-start","synapse:pdpServer.getDataSetCreationStatus-end")}performance.mark("synapse:verifyDataSetCreation-start");const i=await this.verifyDataSetCreation(e);performance.mark("synapse:verifyDataSetCreation-end"),performance.measure("synapse:verifyDataSetCreation","synapse:verifyDataSetCreation-start","synapse:verifyDataSetCreation-end");const a=i.transactionMined&&i.transactionSuccess&&null!=i.dataSetId&&i.dataSetLive&&null!=r&&!0===r.ok&&r.dataSetCreated,s=r?.dataSetId??i.dataSetId??null;let o=i.error??null;return null!=r&&!1===r.ok&&(o=`Server reported transaction failed (status: ${r.txStatus})`),{txHash:n,serverStatus:r,chainStatus:i,summary:{isComplete:a,isLive:i.dataSetLive,dataSetId:s,error:o}}}async waitForDataSetCreationWithStatus(e,t,n=g.DATA_SET_CREATION_TIMEOUT_MS,r=g.DATA_SET_CREATION_POLL_INTERVAL_MS,i){const a=Date.now();for(;Date.now()-a<n;){const n=await this.getComprehensiveDataSetStatus(e,t),s=Date.now()-a;if(null!=i)try{await i(n,s)}catch(e){console.error("Error in progress callback:",e)}if(n.summary.isComplete)return n;if(null!=n.summary.error&&n.chainStatus.transactionMined)throw new Error(n.summary.error);await new Promise(e=>setTimeout(e,r))}throw new Error(`Data set creation timed out after ${n/1e3} seconds`)}async getServicePrice(){const e=this._getWarmStorageContract(),t=await e.getServicePrice();return{pricePerTiBPerMonthNoCDN:t.pricePerTiBPerMonthNoCDN,pricePerTiBPerMonthWithCDN:t.pricePerTiBPerMonthWithCDN,tokenAddress:t.tokenAddress,epochsPerMonth:t.epochsPerMonth}}async calculateStorageCost(e){const t=await this.getServicePrice(),n=BigInt(e),r=t.pricePerTiBPerMonthNoCDN*n/(f.TiB*t.epochsPerMonth),i=t.pricePerTiBPerMonthWithCDN*n/(f.TiB*t.epochsPerMonth);return{perEpoch:r,perDay:r*BigInt(m.EPOCHS_PER_DAY),perMonth:r*t.epochsPerMonth,withCDN:{perEpoch:i,perDay:i*BigInt(m.EPOCHS_PER_DAY),perMonth:i*t.epochsPerMonth}}}async checkAllowanceForStorage(e,t,n,r){const[i,a]=await Promise.all([n.serviceApproval(this._warmStorageAddress,l.USDFC),this.calculateStorageCost(e)]),s=t?a.withCDN:a,o=s.perEpoch,p=o*(BigInt(r??Number(m.DEFAULT_LOCKUP_DAYS))*BigInt(m.EPOCHS_PER_DAY)),d=BigInt(i.rateUsed)+o,u=BigInt(i.lockupUsed)+p,y=i.rateAllowance>=d&&i.lockupAllowance>=u,c=d>i.rateAllowance?d-i.rateAllowance:0n,h=u>i.lockupAllowance?u-i.lockupAllowance:0n;let f;if(!y){const e=c>0n,t=h>0n;e&&t?f="Insufficient rate and lockup allowances":e?f="Insufficient rate allowance":t&&(f="Insufficient lockup allowance")}return{rateAllowanceNeeded:c,lockupAllowanceNeeded:h,currentRateAllowance:i.rateAllowance,currentLockupAllowance:i.lockupAllowance,currentRateUsed:i.rateUsed,currentLockupUsed:i.lockupUsed,sufficient:y,message:f,costs:s,depositAmountNeeded:p}}async prepareStorageUpload(e,t){const[n,r]=await Promise.all([this.calculateStorageCost(e.dataSize),this.checkAllowanceForStorage(e.dataSize,e.withCDN??!1,t)]),i=e.withCDN?n.withCDN:n,a=[],s=await t.accountInfo(l.USDFC),o=i.perMonth;if(s.availableFunds<o){const e=o-s.availableFunds;a.push({type:"deposit",description:`Deposit ${e} USDFC to payments contract`,execute:async()=>await t.deposit(e,l.USDFC)})}return r.sufficient||a.push({type:"approveService",description:`Approve service with rate allowance ${r.rateAllowanceNeeded} and lockup allowance ${r.lockupAllowanceNeeded}`,execute:async()=>await t.approveService(this._warmStorageAddress,r.rateAllowanceNeeded,r.lockupAllowanceNeeded,86400n,l.USDFC)}),{estimatedCost:{perEpoch:i.perEpoch,perDay:i.perDay,perMonth:i.perMonth},allowanceCheck:{sufficient:r.sufficient,message:r.sufficient?void 0:`Insufficient allowances: rate needed ${r.rateAllowanceNeeded}, lockup needed ${r.lockupAllowanceNeeded}`},actions:a}}async addApprovedProvider(e,t){const n=this._getWarmStorageContract().connect(e);return await n.addApprovedProvider(t)}async removeApprovedProvider(e,t){const n=this._getWarmStorageContract().connect(e),r=this._getWarmStorageViewContract(),i=(await r.getApprovedProviders()).findIndex(e=>Number(e)===t);if(-1===i)throw new Error(`Provider ${t} is not in the approved list`);return await n.removeApprovedProvider(t,i)}async getApprovedProviderIds(){const e=this._getWarmStorageViewContract();return(await e.getApprovedProviders()).map(e=>Number(e))}async isProviderIdApproved(e){const t=this._getWarmStorageViewContract();return await t.isProviderApproved(e)}async getOwner(){const e=this._getWarmStorageContract();return await e.owner()}async isOwner(e){const t=await e.getAddress(),n=await this.getOwner();return t.toLowerCase()===n.toLowerCase()}async getMaxProvingPeriod(){const e=this._getWarmStorageViewContract(),t=await e.getMaxProvingPeriod();return Number(t)}async getChallengeWindow(){const e=this._getWarmStorageViewContract(),t=await e.challengeWindow();return Number(t)}}class yr{_signer;_network;_withCDN;_payments;_provider;_warmStorageAddress;_warmStorageService;_pieceRetriever;_storageManager;static async create(e){if(1!==[e.privateKey,e.provider,e.signer].filter(Boolean).length)throw new Error("Must provide exactly one of: privateKey, provider, or signer");let t,n,r;if(null!=e.privateKey){const i=e.rpcURL??e.rpcURL;if(null==i)throw new Error("rpcURL is required when using privateKey");let a=e.privateKey;a.startsWith("0x")||(a=`0x${a}`),r=new u.ethers.JsonRpcProvider(i),t=await D(r);const s=new u.ethers.Wallet(a,r);n=!0===e.disableNonceManager?s:new u.ethers.NonceManager(s)}else if(null!=e.provider){if(r=e.provider,t=await D(r),!("getSigner"in r)||"function"!=typeof r.getSigner)throw new Error("Provider does not support signing operations");{const t=await r.getSigner(0);n=!0===e.disableNonceManager?t:new u.ethers.NonceManager(t)}}else{if(null==e.signer)throw new Error("No valid authentication method provided");if(n=e.signer,!0===e.disableNonceManager||n instanceof u.ethers.NonceManager||(n=new u.ethers.NonceManager(n)),null==n.provider)throw new Error("Signer must have a provider");r=n.provider,t=await D(r)}if("mainnet"!==t&&"calibration"!==t)throw new Error(`Invalid network: ${String(t)}. Only 'mainnet' and 'calibration' are supported.`);const i=e.warmStorageAddress??w.WARM_STORAGE[t];if(!i)throw new Error(`No Warm Storage address configured for network: ${t}`);const a=await lr.create(r,i),s=a.getPaymentsAddress(),o=a.getUSDFCTokenAddress(),p=new x(r,n,s,o,!0===e.disableNonceManager),d=a.getServiceProviderRegistryAddress(),l=new Qn(r,d);let y;if(null!=e.pieceRetriever)y=e.pieceRetriever;else{let n=new pr(a,l);if(null!=e.subgraphConfig||null!=e.subgraphService){const t=null!=e.subgraphService?e.subgraphService:new sr(e.subgraphConfig);n=new ur(t)}y=new dr(n,t)}return new yr(n,r,t,p,!0===e.withCDN,i,a,y)}constructor(e,t,n,r,i,a,s,o){this._signer=e,this._provider=t,this._network=n,this._payments=r,this._withCDN=i,this._warmStorageService=s,this._pieceRetriever=o,this._warmStorageAddress=a,this._storageManager=new Jn(this,this._warmStorageService,this._pieceRetriever,this._withCDN)}getNetwork(){return this._network}getSigner(){return this._signer}getProvider(){return this._provider}getChainId(){return"mainnet"===this._network?y.mainnet:y.calibration}getWarmStorageAddress(){return this._warmStorageAddress}getPaymentsAddress(){return this._warmStorageService.getPaymentsAddress()}getPDPVerifierAddress(){return this._warmStorageService.getPDPVerifierAddress()}get payments(){return this._payments}get storage(){return this._storageManager}async createStorage(e={}){return await this._storageManager.createContext(e)}async download(e,t){return console.warn("synapse.download() is deprecated. Use synapse.storage.download() instead."),await this._storageManager.download(e,t)}async getProviderInfo(e){try{if("string"==typeof e)try{u.ethers.getAddress(e)}catch{throw new Error(`Invalid provider address: ${e}`)}const t=this._warmStorageService.getServiceProviderRegistryAddress(),n=new Qn(this._provider,t),r=new Yn(this._warmStorageService,n);let i;if(i="string"==typeof e?await r.getApprovedProviderByAddress(e):await r.getApprovedProvider(e),null==i)throw new Error(`Provider ${e} not found or not approved`);return i}catch(e){if(e instanceof Error&&e.message.includes("Invalid provider address"))throw e;if(e instanceof Error&&e.message.includes("is not approved"))throw e;if(e instanceof Error&&e.message.includes("not found"))throw e;throw new Error(`Failed to get provider info: ${e instanceof Error?e.message:String(e)}`)}}async getStorageInfo(){return console.warn("synapse.getStorageInfo() is deprecated. Use synapse.storage.getStorageInfo() instead."),await this._storageManager.getStorageInfo()}}const cr={...d,...s,...o,...p};return i.default})());